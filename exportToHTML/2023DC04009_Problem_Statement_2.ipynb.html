<html>
<head>
<title>2023DC04009_Problem_Statement_2.ipynb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.ls0 { height: 1px; border-width: 0; color: #43454a; background-color:#43454a}
.ln { color: #4b5059; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
2023DC04009_Problem_Statement_2.ipynb</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">#%% 
<a name="l2"><span class="ln">2    </span></a>## REQUIRED LIBRARIES</span>
<a name="l3"><span class="ln">3    </span></a><span class="s0"># For data wrangling</span>
<a name="l4"><span class="ln">4    </span></a><span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<a name="l5"><span class="ln">5    </span></a><span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<a name="l6"><span class="ln">6    </span></a>
<a name="l7"><span class="ln">7    </span></a><span class="s0"># For visualization</span>
<a name="l8"><span class="ln">8    </span></a><span class="s2">import </span><span class="s1">seaborn </span><span class="s2">as </span><span class="s1">sns</span>
<a name="l9"><span class="ln">9    </span></a><span class="s2">import </span><span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">pyplot </span><span class="s2">as </span><span class="s1">plt</span>
<a name="l10"><span class="ln">10   </span></a><span class="s2">import </span><span class="s1">plotly</span><span class="s3">.</span><span class="s1">express </span><span class="s2">as </span><span class="s1">px</span>
<a name="l11"><span class="ln">11   </span></a><span class="s2">from </span><span class="s1">plotly</span><span class="s3">.</span><span class="s1">offline </span><span class="s2">import </span><span class="s1">init_notebook_mode</span>
<a name="l12"><span class="ln">12   </span></a>
<a name="l13"><span class="ln">13   </span></a><span class="s0"># For preprocessing and modeling</span>
<a name="l14"><span class="ln">14   </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">preprocessing </span><span class="s2">import </span><span class="s1">LabelEncoder</span>
<a name="l15"><span class="ln">15   </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">preprocessing </span><span class="s2">import </span><span class="s1">MinMaxScaler</span>
<a name="l16"><span class="ln">16   </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">ensemble </span><span class="s2">import </span><span class="s1">RandomForestClassifier</span>
<a name="l17"><span class="ln">17   </span></a>
<a name="l18"><span class="ln">18   </span></a><span class="s0">#Model building</span>
<a name="l19"><span class="ln">19   </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">tree </span><span class="s2">import </span><span class="s1">DecisionTreeClassifier</span>
<a name="l20"><span class="ln">20   </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">model_selection </span><span class="s2">import </span><span class="s1">GridSearchCV</span><span class="s3">, </span><span class="s1">train_test_split</span>
<a name="l21"><span class="ln">21   </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">metrics </span><span class="s2">import </span><span class="s1">accuracy_score</span><span class="s3">, </span><span class="s1">precision_score</span><span class="s3">, </span><span class="s1">recall_score</span><span class="s3">, </span><span class="s1">f1_score</span><span class="s3">, </span><span class="s1">roc_auc_score</span>
<a name="l22"><span class="ln">22   </span></a>
<a name="l23"><span class="ln">23   </span></a>
<a name="l24"><span class="ln">24   </span></a>
<a name="l25"><span class="ln">25   </span></a>
<a name="l26"><span class="ln">26   </span></a><span class="s1">init_notebook_mode</span><span class="s3">(</span><span class="s1">connected</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l27"><span class="ln">27   </span></a>
<a name="l28"><span class="ln">28   </span></a><hr class="ls0"><a name="l29"><span class="ln">29   </span></a><span class="s0">#%% 
<a name="l30"><span class="ln">30   </span></a></span><span class="s1">df </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s4">'customer_churn_dataset.csv'</span><span class="s3">)</span>
<a name="l31"><span class="ln">31   </span></a><span class="s1">df</span><span class="s3">.</span><span class="s1">head</span><span class="s3">(</span><span class="s5">2</span><span class="s3">)</span><hr class="ls0"><a name="l32"><span class="ln">32   </span></a><span class="s0">#%% 
<a name="l33"><span class="ln">33   </span></a></span><span class="s1">df</span><span class="s3">.</span><span class="s1">shape</span><hr class="ls0"><a name="l34"><span class="ln">34   </span></a><span class="s0">#%% 
<a name="l35"><span class="ln">35   </span></a></span><span class="s1">df</span><span class="s3">.</span><span class="s1">info</span><span class="s3">()</span><hr class="ls0"><a name="l36"><span class="ln">36   </span></a><span class="s0">#%% 
<a name="l37"><span class="ln">37   </span></a></span><span class="s1">df</span><span class="s3">.</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">()</span><hr class="ls0"><a name="l38"><span class="ln">38   </span></a><span class="s0">#%% md 
<a name="l39"><span class="ln">39   </span></a></span><span class="s1">Possible visualizations that can be done: 
<a name="l40"><span class="ln">40   </span></a>1. Total data churn 
<a name="l41"><span class="ln">41   </span></a>2. By gender and then one by one <hr class="ls0"><a name="l42"><span class="ln">42   </span></a></span><span class="s0">#%% 
<a name="l43"><span class="ln">43   </span></a></span><span class="s1">churned_out_color </span><span class="s3">= </span><span class="s4">'#B71C1C'</span>
<a name="l44"><span class="ln">44   </span></a><span class="s1">active_customers_color </span><span class="s3">= </span><span class="s4">'#00BFA5'</span><hr class="ls0"><a name="l45"><span class="ln">45   </span></a><span class="s0">#%% 
<a name="l46"><span class="ln">46   </span></a># Prepare the data</span>
<a name="l47"><span class="ln">47   </span></a><span class="s1">labels </span><span class="s3">= [</span><span class="s4">'Churned Out'</span><span class="s3">, </span><span class="s4">'Active Customers'</span><span class="s3">]</span>
<a name="l48"><span class="ln">48   </span></a><span class="s1">sizes </span><span class="s3">= [</span><span class="s1">df</span><span class="s3">.</span><span class="s1">Churn</span><span class="s3">[</span><span class="s1">df</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">] == </span><span class="s5">1</span><span class="s3">].</span><span class="s1">count</span><span class="s3">(), </span><span class="s1">df</span><span class="s3">.</span><span class="s1">Churn</span><span class="s3">[</span><span class="s1">df</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">] == </span><span class="s5">0</span><span class="s3">].</span><span class="s1">count</span><span class="s3">()]</span>
<a name="l49"><span class="ln">49   </span></a><span class="s1">print</span><span class="s3">(</span><span class="s1">sizes</span><span class="s3">)</span>
<a name="l50"><span class="ln">50   </span></a>
<a name="l51"><span class="ln">51   </span></a><span class="s0"># Create the pie chart</span>
<a name="l52"><span class="ln">52   </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">pie</span><span class="s3">(</span>
<a name="l53"><span class="ln">53   </span></a>    <span class="s1">names</span><span class="s3">=</span><span class="s1">labels</span><span class="s3">,</span>
<a name="l54"><span class="ln">54   </span></a>    <span class="s1">values</span><span class="s3">=</span><span class="s1">sizes</span><span class="s3">,</span>
<a name="l55"><span class="ln">55   </span></a>    <span class="s1">title</span><span class="s3">=</span><span class="s4">&quot;Proportion of Customers Churned out and Active Customers&quot;</span><span class="s3">,</span>
<a name="l56"><span class="ln">56   </span></a>    <span class="s1">hole</span><span class="s3">=</span><span class="s5">0.0</span><span class="s3">,  </span><span class="s0"># For a standard pie chart; set hole=0.5 for a donut chart</span>
<a name="l57"><span class="ln">57   </span></a><span class="s3">)</span>
<a name="l58"><span class="ln">58   </span></a>
<a name="l59"><span class="ln">59   </span></a><span class="s0"># Optional: Tuning visual appearance</span>
<a name="l60"><span class="ln">60   </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_traces</span><span class="s3">(</span>
<a name="l61"><span class="ln">61   </span></a>    <span class="s1">pull</span><span class="s3">=[</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0.05</span><span class="s3">],  </span><span class="s0"># Pulls the 'Retained' slice out slightly, similar to &quot;explode&quot;</span>
<a name="l62"><span class="ln">62   </span></a>    <span class="s1">textinfo</span><span class="s3">=</span><span class="s4">'percent+label'</span><span class="s3">,  </span><span class="s0"># Show percentage and label together</span>
<a name="l63"><span class="ln">63   </span></a>    <span class="s1">hoverinfo</span><span class="s3">=</span><span class="s4">'label+percent+value'</span><span class="s3">,  </span><span class="s0"># Hover information</span>
<a name="l64"><span class="ln">64   </span></a>    <span class="s1">marker</span><span class="s3">=</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">line</span><span class="s3">=</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">color</span><span class="s3">=</span><span class="s4">'black'</span><span class="s3">, </span><span class="s1">width</span><span class="s3">=</span><span class="s5">0.5</span><span class="s3">),</span><span class="s1">colors</span><span class="s3">=[</span><span class="s1">churned_out_color</span><span class="s3">, </span><span class="s1">active_customers_color</span><span class="s3">]),  </span><span class="s0"># Customize marker line</span>
<a name="l65"><span class="ln">65   </span></a><span class="s3">)</span>
<a name="l66"><span class="ln">66   </span></a>
<a name="l67"><span class="ln">67   </span></a><span class="s0"># Adjust the layout to set the width and height</span>
<a name="l68"><span class="ln">68   </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span>
<a name="l69"><span class="ln">69   </span></a>    <span class="s1">width</span><span class="s3">=</span><span class="s5">800</span><span class="s3">,  </span><span class="s0"># Set desired width (e.g., 600 pixels)</span>
<a name="l70"><span class="ln">70   </span></a>    <span class="s1">height</span><span class="s3">=</span><span class="s5">500  </span><span class="s0"># Set desired height (e.g., 400 pixels)</span>
<a name="l71"><span class="ln">71   </span></a><span class="s3">)</span>
<a name="l72"><span class="ln">72   </span></a>
<a name="l73"><span class="ln">73   </span></a>
<a name="l74"><span class="ln">74   </span></a><span class="s0"># Show the chart</span>
<a name="l75"><span class="ln">75   </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">(</span><span class="s1">renderer</span><span class="s3">=</span><span class="s4">'iframe'</span><span class="s3">)</span>
<a name="l76"><span class="ln">76   </span></a><hr class="ls0"><a name="l77"><span class="ln">77   </span></a><span class="s0">#%% 
<a name="l78"><span class="ln">78   </span></a># Create a copy of the original DataFrame</span>
<a name="l79"><span class="ln">79   </span></a><span class="s1">df_copy </span><span class="s3">= </span><span class="s1">df</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">()</span>
<a name="l80"><span class="ln">80   </span></a>
<a name="l81"><span class="ln">81   </span></a><span class="s0"># Drop the customerID column</span>
<a name="l82"><span class="ln">82   </span></a><span class="s2">if </span><span class="s4">'customerID' </span><span class="s2">in </span><span class="s1">df</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">:</span>
<a name="l83"><span class="ln">83   </span></a>    <span class="s1">df </span><span class="s3">= </span><span class="s1">df</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">'customerID'</span><span class="s3">])</span>
<a name="l84"><span class="ln">84   </span></a>
<a name="l85"><span class="ln">85   </span></a><span class="s0"># Drop the customerID column</span>
<a name="l86"><span class="ln">86   </span></a><span class="s2">if </span><span class="s4">'customerID' </span><span class="s2">in </span><span class="s1">df_copy</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">:</span>
<a name="l87"><span class="ln">87   </span></a>    <span class="s1">df_copy </span><span class="s3">= </span><span class="s1">df_copy</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">'customerID'</span><span class="s3">])</span>
<a name="l88"><span class="ln">88   </span></a>
<a name="l89"><span class="ln">89   </span></a><span class="s0"># Map the Churn column to the desired labels in the copy</span>
<a name="l90"><span class="ln">90   </span></a><span class="s1">df_copy</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">] = </span><span class="s1">df_copy</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">].</span><span class="s1">map</span><span class="s3">({</span><span class="s5">0</span><span class="s3">: </span><span class="s4">'Active Customers'</span><span class="s3">, </span><span class="s5">1</span><span class="s3">: </span><span class="s4">'Churned Out'</span><span class="s3">})</span>
<a name="l91"><span class="ln">91   </span></a><span class="s1">df_copy</span><span class="s3">[</span><span class="s4">'SeniorCitizen'</span><span class="s3">] = </span><span class="s1">df_copy</span><span class="s3">[</span><span class="s4">'SeniorCitizen'</span><span class="s3">].</span><span class="s1">map</span><span class="s3">({</span><span class="s5">0</span><span class="s3">: </span><span class="s4">'Non-Senior Citizen'</span><span class="s3">, </span><span class="s5">1</span><span class="s3">: </span><span class="s4">'Senior Citizen'</span><span class="s3">})</span><hr class="ls0"><a name="l92"><span class="ln">92   </span></a><span class="s0">#%% 
<a name="l93"><span class="ln">93   </span></a>#Gender</span>
<a name="l94"><span class="ln">94   </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">histogram</span><span class="s3">(</span><span class="s1">df_copy</span><span class="s3">,</span>
<a name="l95"><span class="ln">95   </span></a>                   <span class="s1">x</span><span class="s3">=</span><span class="s4">'gender'</span><span class="s3">,</span>
<a name="l96"><span class="ln">96   </span></a>                   <span class="s1">color</span><span class="s3">=</span><span class="s4">'Churn'</span><span class="s3">,</span>
<a name="l97"><span class="ln">97   </span></a>                   <span class="s1">title</span><span class="s3">=</span><span class="s4">'Churn Rate by Gender'</span><span class="s3">,</span>
<a name="l98"><span class="ln">98   </span></a>                   <span class="s1">barmode</span><span class="s3">=</span><span class="s4">'group'</span><span class="s3">,</span>
<a name="l99"><span class="ln">99   </span></a>                   <span class="s1">color_discrete_sequence</span><span class="s3">=[</span><span class="s1">churned_out_color</span><span class="s3">,</span><span class="s1">active_customers_color</span><span class="s3">],)</span>
<a name="l100"><span class="ln">100  </span></a>
<a name="l101"><span class="ln">101  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span><span class="s1">xaxis_title</span><span class="s3">=</span><span class="s4">'Active Customers vs Churned out'</span><span class="s3">, </span><span class="s1">yaxis_title</span><span class="s3">=</span><span class="s4">'Count'</span><span class="s3">, </span><span class="s1">width</span><span class="s3">=</span><span class="s5">800</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s5">400</span><span class="s3">)</span>
<a name="l102"><span class="ln">102  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">(</span><span class="s1">renderer</span><span class="s3">=</span><span class="s4">'iframe'</span><span class="s3">)</span><hr class="ls0"><a name="l103"><span class="ln">103  </span></a><span class="s0">#%% 
<a name="l104"><span class="ln">104  </span></a>#SeniorCitizen</span>
<a name="l105"><span class="ln">105  </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">histogram</span><span class="s3">(</span><span class="s1">df_copy</span><span class="s3">,</span>
<a name="l106"><span class="ln">106  </span></a>                   <span class="s1">x</span><span class="s3">=</span><span class="s4">'SeniorCitizen'</span><span class="s3">,</span>
<a name="l107"><span class="ln">107  </span></a>                   <span class="s1">color</span><span class="s3">=</span><span class="s4">'Churn'</span><span class="s3">,</span>
<a name="l108"><span class="ln">108  </span></a>                   <span class="s1">title</span><span class="s3">=</span><span class="s4">'Churn Rate by Senior Citizen'</span><span class="s3">,</span>
<a name="l109"><span class="ln">109  </span></a>                   <span class="s1">barmode</span><span class="s3">=</span><span class="s4">'group'</span><span class="s3">,</span>
<a name="l110"><span class="ln">110  </span></a>                   <span class="s1">color_discrete_sequence</span><span class="s3">=[</span><span class="s1">churned_out_color</span><span class="s3">,</span><span class="s1">active_customers_color</span><span class="s3">],)</span>
<a name="l111"><span class="ln">111  </span></a>
<a name="l112"><span class="ln">112  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span><span class="s1">xaxis_title</span><span class="s3">=</span><span class="s4">'Active Customers vs Churned out'</span><span class="s3">, </span><span class="s1">yaxis_title</span><span class="s3">=</span><span class="s4">'Count'</span><span class="s3">, </span><span class="s1">width</span><span class="s3">=</span><span class="s5">800</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s5">400</span><span class="s3">)</span>
<a name="l113"><span class="ln">113  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">(</span><span class="s1">renderer</span><span class="s3">=</span><span class="s4">'iframe'</span><span class="s3">)</span>
<a name="l114"><span class="ln">114  </span></a>
<a name="l115"><span class="ln">115  </span></a><hr class="ls0"><a name="l116"><span class="ln">116  </span></a><span class="s0">#%% 
<a name="l117"><span class="ln">117  </span></a>#Partner</span>
<a name="l118"><span class="ln">118  </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">histogram</span><span class="s3">(</span><span class="s1">df_copy</span><span class="s3">,</span>
<a name="l119"><span class="ln">119  </span></a>                   <span class="s1">x</span><span class="s3">=</span><span class="s4">'Partner'</span><span class="s3">,</span>
<a name="l120"><span class="ln">120  </span></a>                   <span class="s1">color</span><span class="s3">=</span><span class="s4">'Churn'</span><span class="s3">,</span>
<a name="l121"><span class="ln">121  </span></a>                   <span class="s1">title</span><span class="s3">=</span><span class="s4">'Churn Rate by Partner'</span><span class="s3">,</span>
<a name="l122"><span class="ln">122  </span></a>                   <span class="s1">barmode</span><span class="s3">=</span><span class="s4">'group'</span><span class="s3">,</span>
<a name="l123"><span class="ln">123  </span></a>                   <span class="s1">color_discrete_sequence</span><span class="s3">=[</span><span class="s1">churned_out_color</span><span class="s3">,</span><span class="s1">active_customers_color</span><span class="s3">],)</span>
<a name="l124"><span class="ln">124  </span></a>
<a name="l125"><span class="ln">125  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span><span class="s1">xaxis_title</span><span class="s3">=</span><span class="s4">'Active Customers vs Churned out'</span><span class="s3">, </span><span class="s1">yaxis_title</span><span class="s3">=</span><span class="s4">'Count'</span><span class="s3">, </span><span class="s1">width</span><span class="s3">=</span><span class="s5">800</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s5">400</span><span class="s3">)</span>
<a name="l126"><span class="ln">126  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">(</span><span class="s1">renderer</span><span class="s3">=</span><span class="s4">'iframe'</span><span class="s3">)</span><hr class="ls0"><a name="l127"><span class="ln">127  </span></a><span class="s0">#%% 
<a name="l128"><span class="ln">128  </span></a>#Dependents</span>
<a name="l129"><span class="ln">129  </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">histogram</span><span class="s3">(</span><span class="s1">df_copy</span><span class="s3">,</span>
<a name="l130"><span class="ln">130  </span></a>                   <span class="s1">x</span><span class="s3">=</span><span class="s4">'Dependents'</span><span class="s3">,</span>
<a name="l131"><span class="ln">131  </span></a>                   <span class="s1">color</span><span class="s3">=</span><span class="s4">'Churn'</span><span class="s3">,</span>
<a name="l132"><span class="ln">132  </span></a>                   <span class="s1">title</span><span class="s3">=</span><span class="s4">'Churn Rate by Dependents'</span><span class="s3">,</span>
<a name="l133"><span class="ln">133  </span></a>                   <span class="s1">barmode</span><span class="s3">=</span><span class="s4">'group'</span><span class="s3">,</span>
<a name="l134"><span class="ln">134  </span></a>                   <span class="s1">color_discrete_sequence</span><span class="s3">=[</span><span class="s1">churned_out_color</span><span class="s3">,</span><span class="s1">active_customers_color</span><span class="s3">],)</span>
<a name="l135"><span class="ln">135  </span></a>
<a name="l136"><span class="ln">136  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span><span class="s1">xaxis_title</span><span class="s3">=</span><span class="s4">'Active Customers vs Churned out'</span><span class="s3">, </span><span class="s1">yaxis_title</span><span class="s3">=</span><span class="s4">'Count'</span><span class="s3">, </span><span class="s1">width</span><span class="s3">=</span><span class="s5">800</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s5">400</span><span class="s3">)</span>
<a name="l137"><span class="ln">137  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">(</span><span class="s1">renderer</span><span class="s3">=</span><span class="s4">'iframe'</span><span class="s3">)</span><hr class="ls0"><a name="l138"><span class="ln">138  </span></a><span class="s0">#%% 
<a name="l139"><span class="ln">139  </span></a>#PhoneService</span>
<a name="l140"><span class="ln">140  </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">histogram</span><span class="s3">(</span><span class="s1">df_copy</span><span class="s3">,</span>
<a name="l141"><span class="ln">141  </span></a>                   <span class="s1">x</span><span class="s3">=</span><span class="s4">'PhoneService'</span><span class="s3">,</span>
<a name="l142"><span class="ln">142  </span></a>                   <span class="s1">color</span><span class="s3">=</span><span class="s4">'Churn'</span><span class="s3">,</span>
<a name="l143"><span class="ln">143  </span></a>                   <span class="s1">title</span><span class="s3">=</span><span class="s4">'Churn Rate by PhoneService'</span><span class="s3">,</span>
<a name="l144"><span class="ln">144  </span></a>                   <span class="s1">barmode</span><span class="s3">=</span><span class="s4">'group'</span><span class="s3">,</span>
<a name="l145"><span class="ln">145  </span></a>                   <span class="s1">color_discrete_sequence</span><span class="s3">=[</span><span class="s1">churned_out_color</span><span class="s3">,</span><span class="s1">active_customers_color</span><span class="s3">],)</span>
<a name="l146"><span class="ln">146  </span></a>
<a name="l147"><span class="ln">147  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span><span class="s1">xaxis_title</span><span class="s3">=</span><span class="s4">'Active Customers vs Churned out'</span><span class="s3">, </span><span class="s1">yaxis_title</span><span class="s3">=</span><span class="s4">'Count'</span><span class="s3">, </span><span class="s1">width</span><span class="s3">=</span><span class="s5">800</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s5">400</span><span class="s3">)</span>
<a name="l148"><span class="ln">148  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">(</span><span class="s1">renderer</span><span class="s3">=</span><span class="s4">'iframe'</span><span class="s3">)</span><hr class="ls0"><a name="l149"><span class="ln">149  </span></a><span class="s0">#%% 
<a name="l150"><span class="ln">150  </span></a>#MultipleLines</span>
<a name="l151"><span class="ln">151  </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">histogram</span><span class="s3">(</span><span class="s1">df_copy</span><span class="s3">,</span>
<a name="l152"><span class="ln">152  </span></a>                   <span class="s1">x</span><span class="s3">=</span><span class="s4">'MultipleLines'</span><span class="s3">,</span>
<a name="l153"><span class="ln">153  </span></a>                   <span class="s1">color</span><span class="s3">=</span><span class="s4">'Churn'</span><span class="s3">,</span>
<a name="l154"><span class="ln">154  </span></a>                   <span class="s1">title</span><span class="s3">=</span><span class="s4">'Churn Rate by MultipleLines'</span><span class="s3">,</span>
<a name="l155"><span class="ln">155  </span></a>                   <span class="s1">barmode</span><span class="s3">=</span><span class="s4">'group'</span><span class="s3">,</span>
<a name="l156"><span class="ln">156  </span></a>                   <span class="s1">color_discrete_sequence</span><span class="s3">=[</span><span class="s1">churned_out_color</span><span class="s3">,</span><span class="s1">active_customers_color</span><span class="s3">],)</span>
<a name="l157"><span class="ln">157  </span></a>
<a name="l158"><span class="ln">158  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span><span class="s1">xaxis_title</span><span class="s3">=</span><span class="s4">'Active Customers vs Churned out'</span><span class="s3">, </span><span class="s1">yaxis_title</span><span class="s3">=</span><span class="s4">'Count'</span><span class="s3">, </span><span class="s1">width</span><span class="s3">=</span><span class="s5">800</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s5">400</span><span class="s3">)</span>
<a name="l159"><span class="ln">159  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">(</span><span class="s1">renderer</span><span class="s3">=</span><span class="s4">'iframe'</span><span class="s3">)</span><hr class="ls0"><a name="l160"><span class="ln">160  </span></a><span class="s0">#%% 
<a name="l161"><span class="ln">161  </span></a>#InternetService</span>
<a name="l162"><span class="ln">162  </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">histogram</span><span class="s3">(</span><span class="s1">df_copy</span><span class="s3">,</span>
<a name="l163"><span class="ln">163  </span></a>                   <span class="s1">x</span><span class="s3">=</span><span class="s4">'InternetService'</span><span class="s3">,</span>
<a name="l164"><span class="ln">164  </span></a>                   <span class="s1">color</span><span class="s3">=</span><span class="s4">'Churn'</span><span class="s3">,</span>
<a name="l165"><span class="ln">165  </span></a>                   <span class="s1">title</span><span class="s3">=</span><span class="s4">'Churn Rate by InternetService'</span><span class="s3">,</span>
<a name="l166"><span class="ln">166  </span></a>                   <span class="s1">barmode</span><span class="s3">=</span><span class="s4">'group'</span><span class="s3">,</span>
<a name="l167"><span class="ln">167  </span></a>                   <span class="s1">color_discrete_sequence</span><span class="s3">=[</span><span class="s1">churned_out_color</span><span class="s3">,</span><span class="s1">active_customers_color</span><span class="s3">],)</span>
<a name="l168"><span class="ln">168  </span></a>
<a name="l169"><span class="ln">169  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span><span class="s1">xaxis_title</span><span class="s3">=</span><span class="s4">'Active Customers vs Churned out'</span><span class="s3">, </span><span class="s1">yaxis_title</span><span class="s3">=</span><span class="s4">'Count'</span><span class="s3">, </span><span class="s1">width</span><span class="s3">=</span><span class="s5">800</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s5">400</span><span class="s3">)</span>
<a name="l170"><span class="ln">170  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">(</span><span class="s1">renderer</span><span class="s3">=</span><span class="s4">'iframe'</span><span class="s3">)</span><hr class="ls0"><a name="l171"><span class="ln">171  </span></a><span class="s0">#%% 
<a name="l172"><span class="ln">172  </span></a>#OnlineSecurity</span>
<a name="l173"><span class="ln">173  </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">histogram</span><span class="s3">(</span><span class="s1">df_copy</span><span class="s3">,</span>
<a name="l174"><span class="ln">174  </span></a>                   <span class="s1">x</span><span class="s3">=</span><span class="s4">'OnlineSecurity'</span><span class="s3">,</span>
<a name="l175"><span class="ln">175  </span></a>                   <span class="s1">color</span><span class="s3">=</span><span class="s4">'Churn'</span><span class="s3">,</span>
<a name="l176"><span class="ln">176  </span></a>                   <span class="s1">title</span><span class="s3">=</span><span class="s4">'Churn Rate by OnlineSecurity'</span><span class="s3">,</span>
<a name="l177"><span class="ln">177  </span></a>                   <span class="s1">barmode</span><span class="s3">=</span><span class="s4">'group'</span><span class="s3">,</span>
<a name="l178"><span class="ln">178  </span></a>                   <span class="s1">color_discrete_sequence</span><span class="s3">=[</span><span class="s1">churned_out_color</span><span class="s3">,</span><span class="s1">active_customers_color</span><span class="s3">],)</span>
<a name="l179"><span class="ln">179  </span></a>
<a name="l180"><span class="ln">180  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span><span class="s1">xaxis_title</span><span class="s3">=</span><span class="s4">'Active Customers vs Churned out'</span><span class="s3">, </span><span class="s1">yaxis_title</span><span class="s3">=</span><span class="s4">'Count'</span><span class="s3">, </span><span class="s1">width</span><span class="s3">=</span><span class="s5">800</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s5">400</span><span class="s3">)</span>
<a name="l181"><span class="ln">181  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">(</span><span class="s1">renderer</span><span class="s3">=</span><span class="s4">'iframe'</span><span class="s3">)</span><hr class="ls0"><a name="l182"><span class="ln">182  </span></a><span class="s0">#%% 
<a name="l183"><span class="ln">183  </span></a>#OnlineBackup</span>
<a name="l184"><span class="ln">184  </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">histogram</span><span class="s3">(</span><span class="s1">df_copy</span><span class="s3">,</span>
<a name="l185"><span class="ln">185  </span></a>                   <span class="s1">x</span><span class="s3">=</span><span class="s4">'OnlineBackup'</span><span class="s3">,</span>
<a name="l186"><span class="ln">186  </span></a>                   <span class="s1">color</span><span class="s3">=</span><span class="s4">'Churn'</span><span class="s3">,</span>
<a name="l187"><span class="ln">187  </span></a>                   <span class="s1">title</span><span class="s3">=</span><span class="s4">'Churn Rate by OnlineBackup'</span><span class="s3">,</span>
<a name="l188"><span class="ln">188  </span></a>                   <span class="s1">barmode</span><span class="s3">=</span><span class="s4">'group'</span><span class="s3">,</span>
<a name="l189"><span class="ln">189  </span></a>                   <span class="s1">color_discrete_sequence</span><span class="s3">=[</span><span class="s1">churned_out_color</span><span class="s3">,</span><span class="s1">active_customers_color</span><span class="s3">],)</span>
<a name="l190"><span class="ln">190  </span></a>
<a name="l191"><span class="ln">191  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span><span class="s1">xaxis_title</span><span class="s3">=</span><span class="s4">'Active Customers vs Churned out'</span><span class="s3">, </span><span class="s1">yaxis_title</span><span class="s3">=</span><span class="s4">'Count'</span><span class="s3">, </span><span class="s1">width</span><span class="s3">=</span><span class="s5">800</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s5">400</span><span class="s3">)</span>
<a name="l192"><span class="ln">192  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">(</span><span class="s1">renderer</span><span class="s3">=</span><span class="s4">'iframe'</span><span class="s3">)</span><hr class="ls0"><a name="l193"><span class="ln">193  </span></a><span class="s0">#%% 
<a name="l194"><span class="ln">194  </span></a>#tenure</span>
<a name="l195"><span class="ln">195  </span></a><span class="s0"># Group and aggregate data</span>
<a name="l196"><span class="ln">196  </span></a><span class="s1">grouped_data </span><span class="s3">= </span><span class="s1">df_copy</span><span class="s3">.</span><span class="s1">groupby</span><span class="s3">([</span><span class="s4">'tenure'</span><span class="s3">, </span><span class="s4">'Churn'</span><span class="s3">]).</span><span class="s1">size</span><span class="s3">().</span><span class="s1">reset_index</span><span class="s3">(</span><span class="s1">name</span><span class="s3">=</span><span class="s4">'Customer Count'</span><span class="s3">)</span>
<a name="l197"><span class="ln">197  </span></a>
<a name="l198"><span class="ln">198  </span></a><span class="s0"># Create the line chart</span>
<a name="l199"><span class="ln">199  </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">line</span><span class="s3">(</span>
<a name="l200"><span class="ln">200  </span></a>    <span class="s1">grouped_data</span><span class="s3">,</span>
<a name="l201"><span class="ln">201  </span></a>    <span class="s1">x</span><span class="s3">=</span><span class="s4">'tenure'</span><span class="s3">,</span>
<a name="l202"><span class="ln">202  </span></a>    <span class="s1">y</span><span class="s3">=</span><span class="s4">'Customer Count'</span><span class="s3">,</span>
<a name="l203"><span class="ln">203  </span></a>    <span class="s1">color</span><span class="s3">=</span><span class="s4">'Churn'</span><span class="s3">,</span>
<a name="l204"><span class="ln">204  </span></a>    <span class="s1">title</span><span class="s3">=</span><span class="s4">'Churn Rate by Tenure'</span><span class="s3">,</span>
<a name="l205"><span class="ln">205  </span></a>    <span class="s1">color_discrete_sequence</span><span class="s3">=[</span><span class="s1">active_customers_color</span><span class="s3">,</span><span class="s1">churned_out_color</span><span class="s3">]</span>
<a name="l206"><span class="ln">206  </span></a><span class="s3">)</span>
<a name="l207"><span class="ln">207  </span></a>
<a name="l208"><span class="ln">208  </span></a><span class="s0"># Update layout for better labels</span>
<a name="l209"><span class="ln">209  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span>
<a name="l210"><span class="ln">210  </span></a>    <span class="s1">xaxis_title</span><span class="s3">=</span><span class="s4">'Tenure'</span><span class="s3">,</span>
<a name="l211"><span class="ln">211  </span></a>    <span class="s1">yaxis_title</span><span class="s3">=</span><span class="s4">'Customer Count'</span><span class="s3">,</span>
<a name="l212"><span class="ln">212  </span></a>    <span class="s1">legend_title</span><span class="s3">=</span><span class="s4">'Churn Status'</span><span class="s3">,</span>
<a name="l213"><span class="ln">213  </span></a>
<a name="l214"><span class="ln">214  </span></a><span class="s3">)</span>
<a name="l215"><span class="ln">215  </span></a>
<a name="l216"><span class="ln">216  </span></a><span class="s0"># Show the figure</span>
<a name="l217"><span class="ln">217  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">(</span><span class="s1">renderer</span><span class="s3">=</span><span class="s4">'iframe'</span><span class="s3">)</span>
<a name="l218"><span class="ln">218  </span></a><hr class="ls0"><a name="l219"><span class="ln">219  </span></a><span class="s0">#%% 
<a name="l220"><span class="ln">220  </span></a># Drop rows with missing values</span>
<a name="l221"><span class="ln">221  </span></a><span class="s1">df_copy </span><span class="s3">= </span><span class="s1">df_copy</span><span class="s3">.</span><span class="s1">dropna</span><span class="s3">()</span>
<a name="l222"><span class="ln">222  </span></a>
<a name="l223"><span class="ln">223  </span></a><span class="s0"># Encode categorical variables</span>
<a name="l224"><span class="ln">224  </span></a><span class="s1">label_encoders </span><span class="s3">= {}</span>
<a name="l225"><span class="ln">225  </span></a><span class="s2">for </span><span class="s1">column </span><span class="s2">in </span><span class="s1">df_copy</span><span class="s3">.</span><span class="s1">select_dtypes</span><span class="s3">(</span><span class="s1">include</span><span class="s3">=[</span><span class="s4">'object'</span><span class="s3">]).</span><span class="s1">columns</span><span class="s3">:</span>
<a name="l226"><span class="ln">226  </span></a>    <span class="s1">le </span><span class="s3">= </span><span class="s1">LabelEncoder</span><span class="s3">()</span>
<a name="l227"><span class="ln">227  </span></a>    <span class="s1">df_copy</span><span class="s3">[</span><span class="s1">column</span><span class="s3">] = </span><span class="s1">le</span><span class="s3">.</span><span class="s1">fit_transform</span><span class="s3">(</span><span class="s1">df_copy</span><span class="s3">[</span><span class="s1">column</span><span class="s3">])</span>
<a name="l228"><span class="ln">228  </span></a>    <span class="s1">label_encoders</span><span class="s3">[</span><span class="s1">column</span><span class="s3">] = </span><span class="s1">le</span>
<a name="l229"><span class="ln">229  </span></a>
<a name="l230"><span class="ln">230  </span></a><span class="s0"># Compute the correlation matrix</span>
<a name="l231"><span class="ln">231  </span></a><span class="s1">correlation_matrix </span><span class="s3">= </span><span class="s1">df_copy</span><span class="s3">.</span><span class="s1">corr</span><span class="s3">()</span>
<a name="l232"><span class="ln">232  </span></a>
<a name="l233"><span class="ln">233  </span></a><span class="s0"># Plot the heatmap</span>
<a name="l234"><span class="ln">234  </span></a><span class="s1">plt</span><span class="s3">.</span><span class="s1">figure</span><span class="s3">(</span><span class="s1">figsize</span><span class="s3">=(</span><span class="s5">10</span><span class="s3">, </span><span class="s5">5</span><span class="s3">))</span>
<a name="l235"><span class="ln">235  </span></a><span class="s1">sns</span><span class="s3">.</span><span class="s1">heatmap</span><span class="s3">(</span><span class="s1">correlation_matrix</span><span class="s3">, </span><span class="s1">annot</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">cmap</span><span class="s3">=</span><span class="s4">'coolwarm'</span><span class="s3">, </span><span class="s1">fmt</span><span class="s3">=</span><span class="s4">'.2f'</span><span class="s3">)</span>
<a name="l236"><span class="ln">236  </span></a><span class="s1">plt</span><span class="s3">.</span><span class="s1">title</span><span class="s3">(</span><span class="s4">'Correlation Matrix'</span><span class="s3">)</span>
<a name="l237"><span class="ln">237  </span></a><span class="s1">plt</span><span class="s3">.</span><span class="s1">show</span><span class="s3">()</span>
<a name="l238"><span class="ln">238  </span></a>
<a name="l239"><span class="ln">239  </span></a><hr class="ls0"><a name="l240"><span class="ln">240  </span></a><span class="s0">#%% 
<a name="l241"><span class="ln">241  </span></a></span>
<a name="l242"><span class="ln">242  </span></a><span class="s0"># Preprocess the data</span>
<a name="l243"><span class="ln">243  </span></a><span class="s1">df_copy </span><span class="s3">= </span><span class="s1">df_copy</span><span class="s3">.</span><span class="s1">dropna</span><span class="s3">()  </span><span class="s0"># Drop rows with missing values</span>
<a name="l244"><span class="ln">244  </span></a><span class="s1">label_encoders </span><span class="s3">= {}</span>
<a name="l245"><span class="ln">245  </span></a><span class="s2">for </span><span class="s1">column </span><span class="s2">in </span><span class="s1">df_copy</span><span class="s3">.</span><span class="s1">select_dtypes</span><span class="s3">(</span><span class="s1">include</span><span class="s3">=[</span><span class="s4">'object'</span><span class="s3">]).</span><span class="s1">columns</span><span class="s3">:</span>
<a name="l246"><span class="ln">246  </span></a>    <span class="s1">le </span><span class="s3">= </span><span class="s1">LabelEncoder</span><span class="s3">()</span>
<a name="l247"><span class="ln">247  </span></a>    <span class="s1">df_copy</span><span class="s3">[</span><span class="s1">column</span><span class="s3">] = </span><span class="s1">le</span><span class="s3">.</span><span class="s1">fit_transform</span><span class="s3">(</span><span class="s1">df_copy</span><span class="s3">[</span><span class="s1">column</span><span class="s3">])</span>
<a name="l248"><span class="ln">248  </span></a>    <span class="s1">label_encoders</span><span class="s3">[</span><span class="s1">column</span><span class="s3">] = </span><span class="s1">le</span>
<a name="l249"><span class="ln">249  </span></a>
<a name="l250"><span class="ln">250  </span></a><span class="s0"># Split the data into features and target</span>
<a name="l251"><span class="ln">251  </span></a><span class="s1">X </span><span class="s3">= </span><span class="s1">df_copy</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">(</span><span class="s4">'Churn'</span><span class="s3">, </span><span class="s1">axis</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l252"><span class="ln">252  </span></a><span class="s1">y </span><span class="s3">= </span><span class="s1">df_copy</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">]</span>
<a name="l253"><span class="ln">253  </span></a>
<a name="l254"><span class="ln">254  </span></a><span class="s0"># Split the data into training and testing sets</span>
<a name="l255"><span class="ln">255  </span></a><span class="s1">X_train</span><span class="s3">, </span><span class="s1">X_test</span><span class="s3">, </span><span class="s1">y_train</span><span class="s3">, </span><span class="s1">y_test </span><span class="s3">= </span><span class="s1">train_test_split</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">test_size</span><span class="s3">=</span><span class="s5">0.2</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">)</span>
<a name="l256"><span class="ln">256  </span></a>
<a name="l257"><span class="ln">257  </span></a><span class="s0"># Train a random forest classifier</span>
<a name="l258"><span class="ln">258  </span></a><span class="s1">clf </span><span class="s3">= </span><span class="s1">RandomForestClassifier</span><span class="s3">(</span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">)</span>
<a name="l259"><span class="ln">259  </span></a><span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X_train</span><span class="s3">, </span><span class="s1">y_train</span><span class="s3">)</span>
<a name="l260"><span class="ln">260  </span></a>
<a name="l261"><span class="ln">261  </span></a><span class="s0"># Get feature importance</span>
<a name="l262"><span class="ln">262  </span></a><span class="s1">feature_importance </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Series</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">.</span><span class="s1">feature_importances_</span><span class="s3">, </span><span class="s1">index</span><span class="s3">=</span><span class="s1">X</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">).</span><span class="s1">sort_values</span><span class="s3">(</span><span class="s1">ascending</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
<a name="l263"><span class="ln">263  </span></a>
<a name="l264"><span class="ln">264  </span></a><span class="s0"># Print feature importance</span>
<a name="l265"><span class="ln">265  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s1">feature_importance</span><span class="s3">)</span>
<a name="l266"><span class="ln">266  </span></a><hr class="ls0"><a name="l267"><span class="ln">267  </span></a><span class="s0">#%% 
<a name="l268"><span class="ln">268  </span></a>#Creating baseline models</span>
<a name="l269"><span class="ln">269  </span></a><span class="s0"># Preprocess the data (assuming df_copy is already preprocessed and ready)</span>
<a name="l270"><span class="ln">270  </span></a><span class="s0"># Split the data into features and target</span>
<a name="l271"><span class="ln">271  </span></a><span class="s1">x </span><span class="s3">= </span><span class="s1">df_copy</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">(</span><span class="s4">'Churn'</span><span class="s3">, </span><span class="s1">axis</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l272"><span class="ln">272  </span></a><span class="s1">y </span><span class="s3">= </span><span class="s1">df_copy</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">]</span>
<a name="l273"><span class="ln">273  </span></a>
<a name="l274"><span class="ln">274  </span></a><span class="s0"># Split the data into training and testing sets</span>
<a name="l275"><span class="ln">275  </span></a><span class="s1">X_train</span><span class="s3">, </span><span class="s1">X_test</span><span class="s3">, </span><span class="s1">y_train</span><span class="s3">, </span><span class="s1">y_test </span><span class="s3">= </span><span class="s1">train_test_split</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">test_size</span><span class="s3">=</span><span class="s5">0.2</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">)</span>
<a name="l276"><span class="ln">276  </span></a>
<a name="l277"><span class="ln">277  </span></a><span class="s0"># Train a Decision Tree classifier</span>
<a name="l278"><span class="ln">278  </span></a><span class="s1">dt_clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">, </span><span class="s1">criterion</span><span class="s3">=</span><span class="s4">'entropy'</span><span class="s3">, </span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">5</span><span class="s3">, )</span>
<a name="l279"><span class="ln">279  </span></a><span class="s1">dt_clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X_train</span><span class="s3">, </span><span class="s1">y_train</span><span class="s3">)</span>
<a name="l280"><span class="ln">280  </span></a>
<a name="l281"><span class="ln">281  </span></a><span class="s0"># Make predictions on the test set</span>
<a name="l282"><span class="ln">282  </span></a><span class="s1">y_pred </span><span class="s3">= </span><span class="s1">dt_clf</span><span class="s3">.</span><span class="s1">predict</span><span class="s3">(</span><span class="s1">X_test</span><span class="s3">)</span>
<a name="l283"><span class="ln">283  </span></a>
<a name="l284"><span class="ln">284  </span></a><span class="s0"># Calculate the accuracy of the model</span>
<a name="l285"><span class="ln">285  </span></a><span class="s1">accuracy </span><span class="s3">= </span><span class="s1">accuracy_score</span><span class="s3">(</span><span class="s1">y_test</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">)</span>
<a name="l286"><span class="ln">286  </span></a><span class="s1">precision </span><span class="s3">= </span><span class="s1">precision_score</span><span class="s3">(</span><span class="s1">y_test</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">)</span>
<a name="l287"><span class="ln">287  </span></a><span class="s1">recall </span><span class="s3">= </span><span class="s1">recall_score</span><span class="s3">(</span><span class="s1">y_test</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">)</span>
<a name="l288"><span class="ln">288  </span></a><span class="s1">f1_score_baseline_dt </span><span class="s3">= </span><span class="s1">f1_score</span><span class="s3">(</span><span class="s1">y_test</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">)</span>
<a name="l289"><span class="ln">289  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Accuracy of the DecisionTreeClassifier model: </span><span class="s2">{</span><span class="s1">accuracy</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l290"><span class="ln">290  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Precision of the DecisionTreeClassifier model: </span><span class="s2">{</span><span class="s1">precision</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l291"><span class="ln">291  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Recall of the DecisionTreeClassifier model: </span><span class="s2">{</span><span class="s1">recall</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l292"><span class="ln">292  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'F1 Score of the DecisionTreeClassifier model: </span><span class="s2">{</span><span class="s1">f1_score_baseline_dt</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l293"><span class="ln">293  </span></a>
<a name="l294"><span class="ln">294  </span></a>
<a name="l295"><span class="ln">295  </span></a>
<a name="l296"><span class="ln">296  </span></a><hr class="ls0"><a name="l297"><span class="ln">297  </span></a><span class="s0">#%% 
<a name="l298"><span class="ln">298  </span></a>#Creating baseline models</span>
<a name="l299"><span class="ln">299  </span></a>
<a name="l300"><span class="ln">300  </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">linear_model </span><span class="s2">import </span><span class="s1">LogisticRegression</span>
<a name="l301"><span class="ln">301  </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">metrics </span><span class="s2">import </span><span class="s1">accuracy_score</span><span class="s3">, </span><span class="s1">precision_score</span><span class="s3">, </span><span class="s1">recall_score</span><span class="s3">, </span><span class="s1">f1_score</span>
<a name="l302"><span class="ln">302  </span></a>
<a name="l303"><span class="ln">303  </span></a><span class="s0"># Preprocess the data (assuming df_copy is already preprocessed and ready)</span>
<a name="l304"><span class="ln">304  </span></a><span class="s0"># Split the data into features and target</span>
<a name="l305"><span class="ln">305  </span></a><span class="s1">x </span><span class="s3">= </span><span class="s1">df_copy</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">(</span><span class="s4">'Churn'</span><span class="s3">, </span><span class="s1">axis</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l306"><span class="ln">306  </span></a><span class="s1">y </span><span class="s3">= </span><span class="s1">df_copy</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">]</span>
<a name="l307"><span class="ln">307  </span></a>
<a name="l308"><span class="ln">308  </span></a><span class="s0"># Split the data into training and testing sets</span>
<a name="l309"><span class="ln">309  </span></a><span class="s1">X_train</span><span class="s3">, </span><span class="s1">X_test</span><span class="s3">, </span><span class="s1">y_train</span><span class="s3">, </span><span class="s1">y_test </span><span class="s3">= </span><span class="s1">train_test_split</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">test_size</span><span class="s3">=</span><span class="s5">0.2</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">)</span>
<a name="l310"><span class="ln">310  </span></a>
<a name="l311"><span class="ln">311  </span></a><span class="s0"># Train a Logistic Regression classifier</span>
<a name="l312"><span class="ln">312  </span></a><span class="s1">lr_clf </span><span class="s3">= </span><span class="s1">LogisticRegression</span><span class="s3">(</span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">, </span><span class="s1">max_iter</span><span class="s3">=</span><span class="s5">500</span><span class="s3">)</span>
<a name="l313"><span class="ln">313  </span></a><span class="s1">lr_clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X_train</span><span class="s3">, </span><span class="s1">y_train</span><span class="s3">)</span>
<a name="l314"><span class="ln">314  </span></a>
<a name="l315"><span class="ln">315  </span></a><span class="s0"># Make predictions on the test set</span>
<a name="l316"><span class="ln">316  </span></a><span class="s1">y_pred </span><span class="s3">= </span><span class="s1">lr_clf</span><span class="s3">.</span><span class="s1">predict</span><span class="s3">(</span><span class="s1">X_test</span><span class="s3">)</span>
<a name="l317"><span class="ln">317  </span></a>
<a name="l318"><span class="ln">318  </span></a><span class="s0"># Calculate the accuracy of the model</span>
<a name="l319"><span class="ln">319  </span></a><span class="s1">accuracy </span><span class="s3">= </span><span class="s1">accuracy_score</span><span class="s3">(</span><span class="s1">y_test</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">)</span>
<a name="l320"><span class="ln">320  </span></a><span class="s1">precision </span><span class="s3">= </span><span class="s1">precision_score</span><span class="s3">(</span><span class="s1">y_test</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">)</span>
<a name="l321"><span class="ln">321  </span></a><span class="s1">recall </span><span class="s3">= </span><span class="s1">recall_score</span><span class="s3">(</span><span class="s1">y_test</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">)</span>
<a name="l322"><span class="ln">322  </span></a><span class="s1">f1_score_baseline_lr </span><span class="s3">= </span><span class="s1">f1_score</span><span class="s3">(</span><span class="s1">y_test</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">)</span>
<a name="l323"><span class="ln">323  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Accuracy of the Logistic Regression model: </span><span class="s2">{</span><span class="s1">accuracy</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l324"><span class="ln">324  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Precision of the Logistic Regression model: </span><span class="s2">{</span><span class="s1">precision</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l325"><span class="ln">325  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Recall of the Logistic Regression model: </span><span class="s2">{</span><span class="s1">recall</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l326"><span class="ln">326  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'F1 Score of the Logistic Regression model: </span><span class="s2">{</span><span class="s1">f1_score_baseline_lr</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l327"><span class="ln">327  </span></a><hr class="ls0"><a name="l328"><span class="ln">328  </span></a><span class="s0">#%% 
<a name="l329"><span class="ln">329  </span></a>#Filling up the missing values</span>
<a name="l330"><span class="ln">330  </span></a>
<a name="l331"><span class="ln">331  </span></a><span class="s0">#Gender</span>
<a name="l332"><span class="ln">332  </span></a><span class="s0"># Check percentage of missing values in 'gender' column</span>
<a name="l333"><span class="ln">333  </span></a><span class="s1">missing_gender_percent </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'gender'</span><span class="s3">].</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">() / </span><span class="s1">len</span><span class="s3">(</span><span class="s1">df</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l334"><span class="ln">334  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;Missing Gender Values: </span><span class="s2">{</span><span class="s1">missing_gender_percent</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">}</span><span class="s4">%&quot;</span><span class="s3">)</span>
<a name="l335"><span class="ln">335  </span></a><span class="s0"># Add a placeholder &quot;Unknown&quot; for missing genders</span>
<a name="l336"><span class="ln">336  </span></a><span class="s1">df</span><span class="s3">[</span><span class="s4">'gender'</span><span class="s3">].</span><span class="s1">fillna</span><span class="s3">(</span><span class="s4">&quot;Unknown&quot;</span><span class="s3">, </span><span class="s1">inplace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l337"><span class="ln">337  </span></a>
<a name="l338"><span class="ln">338  </span></a>
<a name="l339"><span class="ln">339  </span></a><span class="s0">#Senior Citizen</span>
<a name="l340"><span class="ln">340  </span></a><span class="s0">#Check for missing values with mode too</span>
<a name="l341"><span class="ln">341  </span></a><span class="s1">missing_senior_citizen_percent </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'SeniorCitizen'</span><span class="s3">].</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">() / </span><span class="s1">len</span><span class="s3">(</span><span class="s1">df</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l342"><span class="ln">342  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;Missing SeniorCitizen Values: </span><span class="s2">{</span><span class="s1">missing_senior_citizen_percent</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">}</span><span class="s4">%&quot;</span><span class="s3">)</span>
<a name="l343"><span class="ln">343  </span></a><span class="s0"># Calculate the proportions of the existing values (50% for each class)</span>
<a name="l344"><span class="ln">344  </span></a><span class="s1">senior_dist </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'SeniorCitizen'</span><span class="s3">].</span><span class="s1">value_counts</span><span class="s3">(</span><span class="s1">normalize</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l345"><span class="ln">345  </span></a><span class="s0"># Fill missing values probabilistically based on the existing distribution</span>
<a name="l346"><span class="ln">346  </span></a><span class="s1">df</span><span class="s3">[</span><span class="s4">'SeniorCitizen'</span><span class="s3">] = </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'SeniorCitizen'</span><span class="s3">].</span><span class="s1">apply</span><span class="s3">(</span>
<a name="l347"><span class="ln">347  </span></a>    <span class="s2">lambda </span><span class="s1">senior_lambda</span><span class="s3">: </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">choice</span><span class="s3">([</span><span class="s5">0.0</span><span class="s3">, </span><span class="s5">1.0</span><span class="s3">], </span><span class="s1">p</span><span class="s3">=</span><span class="s1">senior_dist</span><span class="s3">.</span><span class="s1">values</span><span class="s3">) </span><span class="s2">if </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">isnull</span><span class="s3">(</span><span class="s1">senior_lambda</span><span class="s3">) </span><span class="s2">else </span><span class="s1">senior_lambda</span>
<a name="l348"><span class="ln">348  </span></a><span class="s3">)</span>
<a name="l349"><span class="ln">349  </span></a>
<a name="l350"><span class="ln">350  </span></a>
<a name="l351"><span class="ln">351  </span></a><span class="s0">#Partner</span>
<a name="l352"><span class="ln">352  </span></a><span class="s1">missing_partner </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'Partner'</span><span class="s3">].</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">() / </span><span class="s1">len</span><span class="s3">(</span><span class="s1">df</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l353"><span class="ln">353  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;Missing Partner Values: </span><span class="s2">{</span><span class="s1">missing_partner</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">}</span><span class="s4">%&quot;</span><span class="s3">)</span>
<a name="l354"><span class="ln">354  </span></a><span class="s1">partner_dist </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'Partner'</span><span class="s3">].</span><span class="s1">value_counts</span><span class="s3">(</span><span class="s1">normalize</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l355"><span class="ln">355  </span></a><span class="s1">df</span><span class="s3">[</span><span class="s4">'Partner'</span><span class="s3">] = </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'Partner'</span><span class="s3">].</span><span class="s1">apply</span><span class="s3">(</span><span class="s2">lambda </span><span class="s1">partner</span><span class="s3">: </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">choice</span><span class="s3">([</span><span class="s4">'Yes'</span><span class="s3">, </span><span class="s4">'No'</span><span class="s3">], </span><span class="s1">p</span><span class="s3">=</span><span class="s1">partner_dist</span><span class="s3">.</span><span class="s1">values</span><span class="s3">) </span><span class="s2">if </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">isnull</span><span class="s3">(</span><span class="s1">partner</span><span class="s3">) </span><span class="s2">else </span><span class="s1">partner</span><span class="s3">)</span>
<a name="l356"><span class="ln">356  </span></a>
<a name="l357"><span class="ln">357  </span></a><span class="s0"># Dependents</span>
<a name="l358"><span class="ln">358  </span></a><span class="s1">missing_dependents </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'Dependents'</span><span class="s3">].</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">() / </span><span class="s1">len</span><span class="s3">(</span><span class="s1">df</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l359"><span class="ln">359  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;Missing Dependents Values: </span><span class="s2">{</span><span class="s1">missing_dependents</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">}</span><span class="s4">%&quot;</span><span class="s3">)</span>
<a name="l360"><span class="ln">360  </span></a><span class="s1">dependent_dist </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'Dependents'</span><span class="s3">].</span><span class="s1">value_counts</span><span class="s3">(</span><span class="s1">normalize</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l361"><span class="ln">361  </span></a><span class="s1">df</span><span class="s3">[</span><span class="s4">'Dependents'</span><span class="s3">] = </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'Dependents'</span><span class="s3">].</span><span class="s1">apply</span><span class="s3">(</span><span class="s2">lambda </span><span class="s1">dependent</span><span class="s3">: </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">choice</span><span class="s3">([</span><span class="s4">'Yes'</span><span class="s3">, </span><span class="s4">'No'</span><span class="s3">], </span><span class="s1">p</span><span class="s3">=</span><span class="s1">dependent_dist</span><span class="s3">.</span><span class="s1">values</span><span class="s3">) </span><span class="s2">if </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">isnull</span><span class="s3">(</span><span class="s1">dependent</span><span class="s3">) </span><span class="s2">else </span><span class="s1">dependent</span><span class="s3">)</span>
<a name="l362"><span class="ln">362  </span></a>
<a name="l363"><span class="ln">363  </span></a>
<a name="l364"><span class="ln">364  </span></a><span class="s0">#Tenure</span>
<a name="l365"><span class="ln">365  </span></a><span class="s1">missing_dependents </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'tenure'</span><span class="s3">].</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">() / </span><span class="s1">len</span><span class="s3">(</span><span class="s1">df</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l366"><span class="ln">366  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;Missing tenure Values: </span><span class="s2">{</span><span class="s1">missing_dependents</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">}</span><span class="s4">%&quot;</span><span class="s3">)</span>
<a name="l367"><span class="ln">367  </span></a><span class="s1">df</span><span class="s3">[</span><span class="s4">'tenure'</span><span class="s3">].</span><span class="s1">fillna</span><span class="s3">(</span><span class="s1">df</span><span class="s3">[</span><span class="s4">'tenure'</span><span class="s3">].</span><span class="s1">median</span><span class="s3">(), </span><span class="s1">inplace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)  </span><span class="s0"># Fill with median</span>
<a name="l368"><span class="ln">368  </span></a>
<a name="l369"><span class="ln">369  </span></a><span class="s0"># PhoneService</span>
<a name="l370"><span class="ln">370  </span></a><span class="s1">missing_phone_service </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'PhoneService'</span><span class="s3">].</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">() / </span><span class="s1">len</span><span class="s3">(</span><span class="s1">df</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l371"><span class="ln">371  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;Missing PhoneService Values: </span><span class="s2">{</span><span class="s1">missing_phone_service</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">}</span><span class="s4">%&quot;</span><span class="s3">)</span>
<a name="l372"><span class="ln">372  </span></a><span class="s1">phoneServicer_dist </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'PhoneService'</span><span class="s3">].</span><span class="s1">value_counts</span><span class="s3">(</span><span class="s1">normalize</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l373"><span class="ln">373  </span></a><span class="s1">df</span><span class="s3">[</span><span class="s4">'PhoneService'</span><span class="s3">] = </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'PhoneService'</span><span class="s3">].</span><span class="s1">apply</span><span class="s3">(</span><span class="s2">lambda </span><span class="s1">phone_servicer</span><span class="s3">: </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">choice</span><span class="s3">([</span><span class="s4">'Yes'</span><span class="s3">, </span><span class="s4">'No'</span><span class="s3">], </span><span class="s1">p</span><span class="s3">=</span><span class="s1">phoneServicer_dist</span><span class="s3">.</span><span class="s1">values</span><span class="s3">) </span><span class="s2">if </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">isnull</span><span class="s3">(</span><span class="s1">phone_servicer</span><span class="s3">) </span><span class="s2">else </span><span class="s1">phone_servicer</span><span class="s3">)</span>
<a name="l374"><span class="ln">374  </span></a>
<a name="l375"><span class="ln">375  </span></a><span class="s0">#MultipleLines</span>
<a name="l376"><span class="ln">376  </span></a><span class="s0"># Calculate the percentage of missing values in the 'MultipleLines' column</span>
<a name="l377"><span class="ln">377  </span></a><span class="s1">missing_multipleLines </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'MultipleLines'</span><span class="s3">].</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">() / </span><span class="s1">len</span><span class="s3">(</span><span class="s1">df</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l378"><span class="ln">378  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;Missing MultipleLines Values: </span><span class="s2">{</span><span class="s1">missing_multipleLines</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">}</span><span class="s4">%&quot;</span><span class="s3">)</span>
<a name="l379"><span class="ln">379  </span></a><span class="s0"># Get the distribution of the existing values in the 'MultipleLines' column</span>
<a name="l380"><span class="ln">380  </span></a><span class="s1">multipleLines_dist </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'MultipleLines'</span><span class="s3">].</span><span class="s1">value_counts</span><span class="s3">(</span><span class="s1">normalize</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l381"><span class="ln">381  </span></a>
<a name="l382"><span class="ln">382  </span></a><span class="s0"># Fill missing values probabilistically based on the existing distribution</span>
<a name="l383"><span class="ln">383  </span></a><span class="s1">df</span><span class="s3">[</span><span class="s4">'MultipleLines'</span><span class="s3">] = </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'MultipleLines'</span><span class="s3">].</span><span class="s1">apply</span><span class="s3">(</span>
<a name="l384"><span class="ln">384  </span></a>    <span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">choice</span><span class="s3">(</span><span class="s1">multipleLines_dist</span><span class="s3">.</span><span class="s1">index</span><span class="s3">, </span><span class="s1">p</span><span class="s3">=</span><span class="s1">multipleLines_dist</span><span class="s3">.</span><span class="s1">values</span><span class="s3">) </span><span class="s2">if </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">isnull</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">else </span><span class="s1">x</span>
<a name="l385"><span class="ln">385  </span></a><span class="s3">)</span>
<a name="l386"><span class="ln">386  </span></a>
<a name="l387"><span class="ln">387  </span></a>
<a name="l388"><span class="ln">388  </span></a><span class="s0"># InternetService</span>
<a name="l389"><span class="ln">389  </span></a><span class="s1">missing_internet_service </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'InternetService'</span><span class="s3">].</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">() / </span><span class="s1">len</span><span class="s3">(</span><span class="s1">df</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l390"><span class="ln">390  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;Missing InternetService Values: </span><span class="s2">{</span><span class="s1">missing_internet_service</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">}</span><span class="s4">%&quot;</span><span class="s3">)</span>
<a name="l391"><span class="ln">391  </span></a><span class="s1">internet_service_dist </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'InternetService'</span><span class="s3">].</span><span class="s1">value_counts</span><span class="s3">(</span><span class="s1">normalize</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l392"><span class="ln">392  </span></a><span class="s1">df</span><span class="s3">[</span><span class="s4">'InternetService'</span><span class="s3">] = </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'InternetService'</span><span class="s3">].</span><span class="s1">apply</span><span class="s3">(</span>
<a name="l393"><span class="ln">393  </span></a>    <span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">choice</span><span class="s3">(</span><span class="s1">internet_service_dist</span><span class="s3">.</span><span class="s1">index</span><span class="s3">, </span><span class="s1">p</span><span class="s3">=</span><span class="s1">internet_service_dist</span><span class="s3">.</span><span class="s1">values</span><span class="s3">) </span><span class="s2">if </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">isnull</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">else </span><span class="s1">x</span>
<a name="l394"><span class="ln">394  </span></a><span class="s3">)</span>
<a name="l395"><span class="ln">395  </span></a>
<a name="l396"><span class="ln">396  </span></a><span class="s0"># OnlineSecurity</span>
<a name="l397"><span class="ln">397  </span></a><span class="s1">missing_online_security </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'OnlineSecurity'</span><span class="s3">].</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">() / </span><span class="s1">len</span><span class="s3">(</span><span class="s1">df</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l398"><span class="ln">398  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;Missing OnlineSecurity Values: </span><span class="s2">{</span><span class="s1">missing_online_security</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">}</span><span class="s4">%&quot;</span><span class="s3">)</span>
<a name="l399"><span class="ln">399  </span></a><span class="s1">online_security_dist </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'OnlineSecurity'</span><span class="s3">].</span><span class="s1">value_counts</span><span class="s3">(</span><span class="s1">normalize</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l400"><span class="ln">400  </span></a><span class="s1">df</span><span class="s3">[</span><span class="s4">'OnlineSecurity'</span><span class="s3">] = </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'OnlineSecurity'</span><span class="s3">].</span><span class="s1">apply</span><span class="s3">(</span>
<a name="l401"><span class="ln">401  </span></a>    <span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">choice</span><span class="s3">(</span><span class="s1">online_security_dist</span><span class="s3">.</span><span class="s1">index</span><span class="s3">, </span><span class="s1">p</span><span class="s3">=</span><span class="s1">online_security_dist</span><span class="s3">.</span><span class="s1">values</span><span class="s3">) </span><span class="s2">if </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">isnull</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">else </span><span class="s1">x</span>
<a name="l402"><span class="ln">402  </span></a><span class="s3">)</span>
<a name="l403"><span class="ln">403  </span></a>
<a name="l404"><span class="ln">404  </span></a><span class="s0"># OnlineBackup</span>
<a name="l405"><span class="ln">405  </span></a><span class="s1">missing_online_backup </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'OnlineBackup'</span><span class="s3">].</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">() / </span><span class="s1">len</span><span class="s3">(</span><span class="s1">df</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l406"><span class="ln">406  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f&quot;Missing OnlineBackup Values: </span><span class="s2">{</span><span class="s1">missing_online_backup</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">}</span><span class="s4">%&quot;</span><span class="s3">)</span>
<a name="l407"><span class="ln">407  </span></a><span class="s1">online_backup_dist </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'OnlineBackup'</span><span class="s3">].</span><span class="s1">value_counts</span><span class="s3">(</span><span class="s1">normalize</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l408"><span class="ln">408  </span></a><span class="s1">df</span><span class="s3">[</span><span class="s4">'OnlineBackup'</span><span class="s3">] = </span><span class="s1">df</span><span class="s3">[</span><span class="s4">'OnlineBackup'</span><span class="s3">].</span><span class="s1">apply</span><span class="s3">(</span>
<a name="l409"><span class="ln">409  </span></a>    <span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">choice</span><span class="s3">(</span><span class="s1">online_backup_dist</span><span class="s3">.</span><span class="s1">index</span><span class="s3">, </span><span class="s1">p</span><span class="s3">=</span><span class="s1">online_backup_dist</span><span class="s3">.</span><span class="s1">values</span><span class="s3">) </span><span class="s2">if </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">isnull</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">else </span><span class="s1">x</span>
<a name="l410"><span class="ln">410  </span></a><span class="s3">)</span>
<a name="l411"><span class="ln">411  </span></a><hr class="ls0"><a name="l412"><span class="ln">412  </span></a><span class="s0">#%% 
<a name="l413"><span class="ln">413  </span></a></span><span class="s1">df</span><span class="s3">.</span><span class="s1">isnull</span><span class="s3">().</span><span class="s1">sum</span><span class="s3">()</span>
<a name="l414"><span class="ln">414  </span></a><hr class="ls0"><a name="l415"><span class="ln">415  </span></a><span class="s0">#%% 
<a name="l416"><span class="ln">416  </span></a></span><span class="s1">df</span><span class="s3">.</span><span class="s1">info</span><span class="s3">()</span><hr class="ls0"><a name="l417"><span class="ln">417  </span></a><span class="s0">#%% 
<a name="l418"><span class="ln">418  </span></a>##Encoding the data</span>
<a name="l419"><span class="ln">419  </span></a>
<a name="l420"><span class="ln">420  </span></a><span class="s0"># Create a LabelEncoder object for binary features</span>
<a name="l421"><span class="ln">421  </span></a><span class="s1">df</span><span class="s3">.</span><span class="s1">head</span><span class="s3">()</span>
<a name="l422"><span class="ln">422  </span></a><span class="s0"># List of binary columns (for Label Encoding)</span>
<a name="l423"><span class="ln">423  </span></a><span class="s1">binary_cols </span><span class="s3">= [</span><span class="s4">'SeniorCitizen'</span><span class="s3">, </span><span class="s4">'Partner'</span><span class="s3">, </span><span class="s4">'Dependents'</span><span class="s3">, </span><span class="s4">'PhoneService'</span><span class="s3">]</span>
<a name="l424"><span class="ln">424  </span></a>
<a name="l425"><span class="ln">425  </span></a><span class="s0"># Apply Label Encoding to binary features</span>
<a name="l426"><span class="ln">426  </span></a><span class="s1">le </span><span class="s3">= </span><span class="s1">LabelEncoder</span><span class="s3">()</span>
<a name="l427"><span class="ln">427  </span></a><span class="s2">for </span><span class="s1">col </span><span class="s2">in </span><span class="s1">binary_cols</span><span class="s3">:</span>
<a name="l428"><span class="ln">428  </span></a>    <span class="s1">df</span><span class="s3">[</span><span class="s1">col</span><span class="s3">] = </span><span class="s1">le</span><span class="s3">.</span><span class="s1">fit_transform</span><span class="s3">(</span><span class="s1">df</span><span class="s3">[</span><span class="s1">col</span><span class="s3">])</span>
<a name="l429"><span class="ln">429  </span></a>
<a name="l430"><span class="ln">430  </span></a><span class="s0"># List of categorical columns (for One-Hot Encoding)</span>
<a name="l431"><span class="ln">431  </span></a><span class="s1">categorical_cols </span><span class="s3">= [</span><span class="s4">'gender'</span><span class="s3">, </span><span class="s4">'MultipleLines'</span><span class="s3">, </span><span class="s4">'InternetService'</span><span class="s3">, </span><span class="s4">'OnlineSecurity'</span><span class="s3">, </span><span class="s4">'OnlineBackup'</span><span class="s3">]</span>
<a name="l432"><span class="ln">432  </span></a>
<a name="l433"><span class="ln">433  </span></a><span class="s0"># Apply One-Hot Encoding</span>
<a name="l434"><span class="ln">434  </span></a><span class="s1">df_preprocessed </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">get_dummies</span><span class="s3">(</span><span class="s1">df</span><span class="s3">, </span><span class="s1">columns</span><span class="s3">=</span><span class="s1">categorical_cols</span><span class="s3">, </span><span class="s1">drop_first</span><span class="s3">=</span><span class="s2">False</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">'int'</span><span class="s3">)</span><hr class="ls0"><a name="l435"><span class="ln">435  </span></a><span class="s0">#%% 
<a name="l436"><span class="ln">436  </span></a># Initialize MinMaxScaler</span>
<a name="l437"><span class="ln">437  </span></a><span class="s1">scaler </span><span class="s3">= </span><span class="s1">MinMaxScaler</span><span class="s3">()</span>
<a name="l438"><span class="ln">438  </span></a>
<a name="l439"><span class="ln">439  </span></a><span class="s0"># Apply MinMaxScaler to the 'tenure' field and create a new column 'scaled_tenure'</span>
<a name="l440"><span class="ln">440  </span></a><span class="s1">df_preprocessed</span><span class="s3">[</span><span class="s4">'scaled_tenure'</span><span class="s3">] = </span><span class="s1">scaler</span><span class="s3">.</span><span class="s1">fit_transform</span><span class="s3">(</span><span class="s1">df</span><span class="s3">[[</span><span class="s4">'tenure'</span><span class="s3">]])</span>
<a name="l441"><span class="ln">441  </span></a><hr class="ls0"><a name="l442"><span class="ln">442  </span></a><span class="s0">#%% 
<a name="l443"><span class="ln">443  </span></a># Print confirmation</span>
<a name="l444"><span class="ln">444  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;DataFrame `df_preprocessed` is ready for model training!&quot;</span><span class="s3">)</span>
<a name="l445"><span class="ln">445  </span></a><span class="s1">df_preprocessed</span><span class="s3">.</span><span class="s1">head</span><span class="s3">()</span><hr class="ls0"><a name="l446"><span class="ln">446  </span></a><span class="s0">#%% 
<a name="l447"><span class="ln">447  </span></a></span><span class="s1">df_preprocessed</span><span class="s3">.</span><span class="s1">describe</span><span class="s3">()</span>
<a name="l448"><span class="ln">448  </span></a><hr class="ls0"><a name="l449"><span class="ln">449  </span></a><span class="s0">#%% 
<a name="l450"><span class="ln">450  </span></a></span><span class="s1">filtered_df </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">'tenure'</span><span class="s3">])</span>
<a name="l451"><span class="ln">451  </span></a><span class="s0"># Box plot for the remaining columns</span>
<a name="l452"><span class="ln">452  </span></a><span class="s1">sns</span><span class="s3">.</span><span class="s1">boxplot</span><span class="s3">(</span><span class="s1">data</span><span class="s3">=</span><span class="s1">filtered_df</span><span class="s3">, </span><span class="s1">orient</span><span class="s3">=</span><span class="s4">'h' </span><span class="s3">)</span>
<a name="l453"><span class="ln">453  </span></a>
<a name="l454"><span class="ln">454  </span></a><span class="s0"># ax = filtered_df.boxplot(vert=False)</span>
<a name="l455"><span class="ln">455  </span></a>
<a name="l456"><span class="ln">456  </span></a><span class="s1">plt</span><span class="s3">.</span><span class="s1">show</span><span class="s3">()</span><hr class="ls0"><a name="l457"><span class="ln">457  </span></a><span class="s0">#%% 
<a name="l458"><span class="ln">458  </span></a>#Finding the best hyperparameters for the Decision tree</span>
<a name="l459"><span class="ln">459  </span></a>
<a name="l460"><span class="ln">460  </span></a><span class="s1">x_dt </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">([</span><span class="s4">'Churn'</span><span class="s3">,</span><span class="s4">'scaled_tenure'</span><span class="s3">], </span><span class="s1">axis</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l461"><span class="ln">461  </span></a><span class="s1">y_dt </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">]</span>
<a name="l462"><span class="ln">462  </span></a>
<a name="l463"><span class="ln">463  </span></a><span class="s0"># Split data into training and testing sets</span>
<a name="l464"><span class="ln">464  </span></a><span class="s1">x_train_dt</span><span class="s3">, </span><span class="s1">x_test_dt</span><span class="s3">, </span><span class="s1">y_train_dt</span><span class="s3">, </span><span class="s1">y_test_dt </span><span class="s3">= </span><span class="s1">train_test_split</span><span class="s3">(</span><span class="s1">x_dt</span><span class="s3">, </span><span class="s1">y_dt</span><span class="s3">, </span><span class="s1">test_size</span><span class="s3">=</span><span class="s5">0.2</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">)</span>
<a name="l465"><span class="ln">465  </span></a>
<a name="l466"><span class="ln">466  </span></a><span class="s0"># Define the refined parameter grid</span>
<a name="l467"><span class="ln">467  </span></a><span class="s1">param_grid </span><span class="s3">= {</span>
<a name="l468"><span class="ln">468  </span></a>    <span class="s4">'max_depth'</span><span class="s3">: [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s5">3</span><span class="s3">, </span><span class="s5">5</span><span class="s3">, </span><span class="s5">7</span><span class="s3">],  </span><span class="s0"># Avoiding 'None' since deep trees overfit</span>
<a name="l469"><span class="ln">469  </span></a>    <span class="s4">'criterion'</span><span class="s3">: [</span><span class="s4">'gini'</span><span class="s3">, </span><span class="s4">'entropy'</span><span class="s3">],</span>
<a name="l470"><span class="ln">470  </span></a>    <span class="s4">'min_samples_split'</span><span class="s3">: [</span><span class="s5">2</span><span class="s3">, </span><span class="s5">3</span><span class="s3">, </span><span class="s5">5</span><span class="s3">],</span>
<a name="l471"><span class="ln">471  </span></a>    <span class="s4">'min_samples_leaf'</span><span class="s3">: [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s5">3</span><span class="s3">]</span>
<a name="l472"><span class="ln">472  </span></a><span class="s3">}</span>
<a name="l473"><span class="ln">473  </span></a>
<a name="l474"><span class="ln">474  </span></a><span class="s0"># Initialize GridSearchCV with 5-fold cross-validation</span>
<a name="l475"><span class="ln">475  </span></a><span class="s1">grid_search </span><span class="s3">= </span><span class="s1">GridSearchCV</span><span class="s3">(</span>
<a name="l476"><span class="ln">476  </span></a>    <span class="s1">estimator</span><span class="s3">=</span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">),</span>
<a name="l477"><span class="ln">477  </span></a>    <span class="s1">param_grid</span><span class="s3">=</span><span class="s1">param_grid</span><span class="s3">,</span>
<a name="l478"><span class="ln">478  </span></a>    <span class="s1">scoring</span><span class="s3">=</span><span class="s4">'f1'</span><span class="s3">,</span>
<a name="l479"><span class="ln">479  </span></a>    <span class="s1">cv</span><span class="s3">=</span><span class="s5">5</span><span class="s3">,</span>
<a name="l480"><span class="ln">480  </span></a>    <span class="s1">verbose</span><span class="s3">=</span><span class="s5">1</span><span class="s3">,</span>
<a name="l481"><span class="ln">481  </span></a>    <span class="s1">n_jobs</span><span class="s3">=-</span><span class="s5">1</span>
<a name="l482"><span class="ln">482  </span></a><span class="s3">)</span>
<a name="l483"><span class="ln">483  </span></a>
<a name="l484"><span class="ln">484  </span></a><span class="s0"># Perform the grid search</span>
<a name="l485"><span class="ln">485  </span></a><span class="s1">grid_search</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">x_train_dt</span><span class="s3">, </span><span class="s1">y_train_dt</span><span class="s3">)</span>
<a name="l486"><span class="ln">486  </span></a>
<a name="l487"><span class="ln">487  </span></a><span class="s0"># Retrieve the best model</span>
<a name="l488"><span class="ln">488  </span></a><span class="s1">best_clf </span><span class="s3">= </span><span class="s1">grid_search</span><span class="s3">.</span><span class="s1">best_estimator_</span>
<a name="l489"><span class="ln">489  </span></a>
<a name="l490"><span class="ln">490  </span></a><span class="s0"># Make predictions on the test set using the best model</span>
<a name="l491"><span class="ln">491  </span></a><span class="s1">y_pred_dt </span><span class="s3">= </span><span class="s1">best_clf</span><span class="s3">.</span><span class="s1">predict</span><span class="s3">(</span><span class="s1">x_test_dt</span><span class="s3">)</span>
<a name="l492"><span class="ln">492  </span></a>
<a name="l493"><span class="ln">493  </span></a><span class="s0"># Evaluate the best model</span>
<a name="l494"><span class="ln">494  </span></a><span class="s1">accuracy_dt </span><span class="s3">= </span><span class="s1">accuracy_score</span><span class="s3">(</span><span class="s1">y_test_dt</span><span class="s3">, </span><span class="s1">y_pred_dt</span><span class="s3">)</span>
<a name="l495"><span class="ln">495  </span></a><span class="s1">precision_dt </span><span class="s3">= </span><span class="s1">precision_score</span><span class="s3">(</span><span class="s1">y_test_dt</span><span class="s3">, </span><span class="s1">y_pred_dt</span><span class="s3">)</span>
<a name="l496"><span class="ln">496  </span></a><span class="s1">recall_dt </span><span class="s3">= </span><span class="s1">recall_score</span><span class="s3">(</span><span class="s1">y_test_dt</span><span class="s3">, </span><span class="s1">y_pred_dt</span><span class="s3">)</span>
<a name="l497"><span class="ln">497  </span></a><span class="s1">f1_score_dt </span><span class="s3">= </span><span class="s1">f1_score</span><span class="s3">(</span><span class="s1">y_test_dt</span><span class="s3">, </span><span class="s1">y_pred_dt</span><span class="s3">)</span>
<a name="l498"><span class="ln">498  </span></a>
<a name="l499"><span class="ln">499  </span></a><span class="s0"># Print the results</span>
<a name="l500"><span class="ln">500  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;Best Parameters for Decision Tree Classifier:&quot;</span><span class="s3">, </span><span class="s1">grid_search</span><span class="s3">.</span><span class="s1">best_params_</span><span class="s3">)</span>
<a name="l501"><span class="ln">501  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Accuracy: </span><span class="s2">{</span><span class="s1">accuracy_dt</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l502"><span class="ln">502  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Precision: </span><span class="s2">{</span><span class="s1">precision_dt</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l503"><span class="ln">503  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Recall: </span><span class="s2">{</span><span class="s1">recall_dt</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l504"><span class="ln">504  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'F1 Score: </span><span class="s2">{</span><span class="s1">f1_score_dt</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l505"><span class="ln">505  </span></a><hr class="ls0"><a name="l506"><span class="ln">506  </span></a><span class="s0">#%% 
<a name="l507"><span class="ln">507  </span></a># Decision Tree Classifier</span>
<a name="l508"><span class="ln">508  </span></a><span class="s1">x_dt </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">([</span><span class="s4">'Churn'</span><span class="s3">,</span><span class="s4">'scaled_tenure'</span><span class="s3">], </span><span class="s1">axis</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l509"><span class="ln">509  </span></a><span class="s1">y_dt </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">]</span>
<a name="l510"><span class="ln">510  </span></a>
<a name="l511"><span class="ln">511  </span></a><span class="s0"># Define test sizes to evaluate</span>
<a name="l512"><span class="ln">512  </span></a><span class="s1">test_sizes </span><span class="s3">= [</span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">0.2</span><span class="s3">, </span><span class="s5">0.3</span><span class="s3">, </span><span class="s5">0.4</span><span class="s3">]</span>
<a name="l513"><span class="ln">513  </span></a>
<a name="l514"><span class="ln">514  </span></a><span class="s0"># Store results for each test size</span>
<a name="l515"><span class="ln">515  </span></a><span class="s1">results_dt </span><span class="s3">= []</span>
<a name="l516"><span class="ln">516  </span></a>
<a name="l517"><span class="ln">517  </span></a><span class="s2">for </span><span class="s1">test_size </span><span class="s2">in </span><span class="s1">test_sizes</span><span class="s3">:</span>
<a name="l518"><span class="ln">518  </span></a>    <span class="s0"># print(f&quot;\nTesting with test_size = {test_size}&quot;)</span>
<a name="l519"><span class="ln">519  </span></a>
<a name="l520"><span class="ln">520  </span></a>    <span class="s0"># Split the data</span>
<a name="l521"><span class="ln">521  </span></a>    <span class="s1">x_train_dt</span><span class="s3">, </span><span class="s1">x_test_dt</span><span class="s3">, </span><span class="s1">y_train_dt</span><span class="s3">, </span><span class="s1">y_test_dt </span><span class="s3">= </span><span class="s1">train_test_split</span><span class="s3">(</span>
<a name="l522"><span class="ln">522  </span></a>        <span class="s1">x_dt</span><span class="s3">, </span><span class="s1">y_dt</span><span class="s3">, </span><span class="s1">test_size</span><span class="s3">=</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span>
<a name="l523"><span class="ln">523  </span></a>    <span class="s3">)</span>
<a name="l524"><span class="ln">524  </span></a>
<a name="l525"><span class="ln">525  </span></a>    <span class="s0"># Initialize and fit the Decision Tree Classifier with the given hyperparameters</span>
<a name="l526"><span class="ln">526  </span></a>    <span class="s1">dt_clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span>
<a name="l527"><span class="ln">527  </span></a>        <span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">,</span>
<a name="l528"><span class="ln">528  </span></a>        <span class="s1">criterion</span><span class="s3">=</span><span class="s4">'entropy'</span><span class="s3">,</span>
<a name="l529"><span class="ln">529  </span></a>        <span class="s1">max_depth</span><span class="s3">=</span><span class="s5">7</span><span class="s3">,</span>
<a name="l530"><span class="ln">530  </span></a>        <span class="s1">min_samples_leaf</span><span class="s3">=</span><span class="s5">1</span><span class="s3">,</span>
<a name="l531"><span class="ln">531  </span></a>        <span class="s1">min_samples_split</span><span class="s3">=</span><span class="s5">2</span>
<a name="l532"><span class="ln">532  </span></a>    <span class="s3">)</span>
<a name="l533"><span class="ln">533  </span></a>    <span class="s1">dt_clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">x_train_dt</span><span class="s3">, </span><span class="s1">y_train_dt</span><span class="s3">)</span>
<a name="l534"><span class="ln">534  </span></a>
<a name="l535"><span class="ln">535  </span></a>    <span class="s0"># Make predictions</span>
<a name="l536"><span class="ln">536  </span></a>    <span class="s1">y_pred_dt </span><span class="s3">= </span><span class="s1">dt_clf</span><span class="s3">.</span><span class="s1">predict</span><span class="s3">(</span><span class="s1">x_test_dt</span><span class="s3">)</span>
<a name="l537"><span class="ln">537  </span></a>
<a name="l538"><span class="ln">538  </span></a>    <span class="s0"># Evaluate performance</span>
<a name="l539"><span class="ln">539  </span></a>    <span class="s1">accuracy </span><span class="s3">= </span><span class="s1">accuracy_score</span><span class="s3">(</span><span class="s1">y_test_dt</span><span class="s3">, </span><span class="s1">y_pred_dt</span><span class="s3">)</span>
<a name="l540"><span class="ln">540  </span></a>    <span class="s1">precision </span><span class="s3">= </span><span class="s1">precision_score</span><span class="s3">(</span><span class="s1">y_test_dt</span><span class="s3">, </span><span class="s1">y_pred_dt</span><span class="s3">, </span><span class="s1">pos_label</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)  </span><span class="s0"># Handle undefined precision</span>
<a name="l541"><span class="ln">541  </span></a>    <span class="s1">recall </span><span class="s3">= </span><span class="s1">recall_score</span><span class="s3">(</span><span class="s1">y_test_dt</span><span class="s3">, </span><span class="s1">y_pred_dt</span><span class="s3">, </span><span class="s1">pos_label</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l542"><span class="ln">542  </span></a>    <span class="s1">f1 </span><span class="s3">= </span><span class="s1">f1_score</span><span class="s3">(</span><span class="s1">y_test_dt</span><span class="s3">, </span><span class="s1">y_pred_dt</span><span class="s3">, </span><span class="s1">pos_label</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l543"><span class="ln">543  </span></a>    <span class="s1">auc_roc_lr </span><span class="s3">= </span><span class="s1">roc_auc_score</span><span class="s3">(</span><span class="s1">y_test_dt</span><span class="s3">, </span><span class="s1">y_pred_dt</span><span class="s3">)</span>
<a name="l544"><span class="ln">544  </span></a>
<a name="l545"><span class="ln">545  </span></a>
<a name="l546"><span class="ln">546  </span></a>    <span class="s0"># Store the results</span>
<a name="l547"><span class="ln">547  </span></a>    <span class="s1">results_dt</span><span class="s3">.</span><span class="s1">append</span><span class="s3">((</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">accuracy</span><span class="s3">, </span><span class="s1">precision</span><span class="s3">, </span><span class="s1">recall</span><span class="s3">, </span><span class="s1">f1</span><span class="s3">, </span><span class="s1">auc_roc_lr </span><span class="s3">))</span>
<a name="l548"><span class="ln">548  </span></a>
<a name="l549"><span class="ln">549  </span></a>    <span class="s0"># print(f&quot;Accuracy: {accuracy:.3f}, Precision: {precision:.3f}, Recall: {recall:.3f}, F1-Score: {f1:.3f}&quot;)</span>
<a name="l550"><span class="ln">550  </span></a>
<a name="l551"><span class="ln">551  </span></a><span class="s0"># Display all results at the end</span>
<a name="l552"><span class="ln">552  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">Summary of Results of Decision Tree Classifier:&quot;</span><span class="s3">)</span>
<a name="l553"><span class="ln">553  </span></a><span class="s2">for </span><span class="s1">i</span><span class="s3">, (</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">accuracy</span><span class="s3">, </span><span class="s1">precision</span><span class="s3">, </span><span class="s1">recall</span><span class="s3">, </span><span class="s1">f1</span><span class="s3">, </span><span class="s1">auc_roc_lr</span><span class="s3">) </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">results_dt</span><span class="s3">):</span>
<a name="l554"><span class="ln">554  </span></a>    <span class="s2">if </span><span class="s1">i </span><span class="s3">== </span><span class="s5">1</span><span class="s3">:  </span><span class="s0"># Highlight the second record</span>
<a name="l555"><span class="ln">555  </span></a>        <span class="s1">print</span><span class="s3">(</span>
<a name="l556"><span class="ln">556  </span></a>            <span class="s4">f&quot;</span><span class="s2">\033</span><span class="s4">[1mTest Size: </span><span class="s2">{</span><span class="s1">test_size</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">} </span><span class="s4">| Accuracy: </span><span class="s2">{</span><span class="s1">accuracy</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Precision: </span><span class="s2">{</span><span class="s1">precision</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Recall: </span><span class="s2">{</span><span class="s1">recall</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, F1-Score: </span><span class="s2">{</span><span class="s1">f1</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, AUC-ROC: </span><span class="s2">{</span><span class="s1">auc_roc_lr</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}\033</span><span class="s4">[0m&quot;</span><span class="s3">)</span>
<a name="l557"><span class="ln">557  </span></a>    <span class="s2">else</span><span class="s3">:</span>
<a name="l558"><span class="ln">558  </span></a>        <span class="s1">print</span><span class="s3">(</span>
<a name="l559"><span class="ln">559  </span></a>            <span class="s4">f&quot;Test Size: </span><span class="s2">{</span><span class="s1">test_size</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">} </span><span class="s4">| Accuracy: </span><span class="s2">{</span><span class="s1">accuracy</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Precision: </span><span class="s2">{</span><span class="s1">precision</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Recall: </span><span class="s2">{</span><span class="s1">recall</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, F1-Score: </span><span class="s2">{</span><span class="s1">f1</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, AUC-ROC: </span><span class="s2">{</span><span class="s1">auc_roc_lr</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
<a name="l560"><span class="ln">560  </span></a><hr class="ls0"><a name="l561"><span class="ln">561  </span></a><span class="s0">#%% md 
<a name="l562"><span class="ln">562  </span></a></span><span class="s1">Here to write about the manual tuning of parameters <hr class="ls0"><a name="l563"><span class="ln">563  </span></a></span><span class="s0">#%% 
<a name="l564"><span class="ln">564  </span></a>#Finding the best hyperparameters for the Logistic Regression</span>
<a name="l565"><span class="ln">565  </span></a>
<a name="l566"><span class="ln">566  </span></a><span class="s0"># Finding the best hyperparameters for Logistic Regression</span>
<a name="l567"><span class="ln">567  </span></a><span class="s1">x_lr </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">([</span><span class="s4">'Churn'</span><span class="s3">, </span><span class="s4">'tenure'</span><span class="s3">], </span><span class="s1">axis</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l568"><span class="ln">568  </span></a><span class="s1">y_lr </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">]</span>
<a name="l569"><span class="ln">569  </span></a>
<a name="l570"><span class="ln">570  </span></a><span class="s0"># Split data into training and testing sets</span>
<a name="l571"><span class="ln">571  </span></a><span class="s1">x_train_lr</span><span class="s3">, </span><span class="s1">x_test_lr</span><span class="s3">, </span><span class="s1">y_train_lr</span><span class="s3">, </span><span class="s1">y_test_lr </span><span class="s3">= </span><span class="s1">train_test_split</span><span class="s3">(</span><span class="s1">x_lr</span><span class="s3">, </span><span class="s1">y_lr</span><span class="s3">, </span><span class="s1">test_size</span><span class="s3">=</span><span class="s5">0.2</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">)</span>
<a name="l572"><span class="ln">572  </span></a>
<a name="l573"><span class="ln">573  </span></a><span class="s0"># Define the parameter grid for Logistic Regression</span>
<a name="l574"><span class="ln">574  </span></a><span class="s0"># Define the parameter grid</span>
<a name="l575"><span class="ln">575  </span></a><span class="s1">param_grid_lr </span><span class="s3">= [</span>
<a name="l576"><span class="ln">576  </span></a>    <span class="s3">{</span><span class="s4">'penalty'</span><span class="s3">: [</span><span class="s4">'l1'</span><span class="s3">], </span><span class="s4">'C'</span><span class="s3">: [</span><span class="s5">0.01</span><span class="s3">, </span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">10</span><span class="s3">], </span><span class="s4">'solver'</span><span class="s3">: [</span><span class="s4">'liblinear'</span><span class="s3">], </span><span class="s4">'max_iter'</span><span class="s3">: [</span><span class="s5">20</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">200</span><span class="s3">]},</span>
<a name="l577"><span class="ln">577  </span></a>    <span class="s3">{</span><span class="s4">'penalty'</span><span class="s3">: [</span><span class="s4">'l2'</span><span class="s3">], </span><span class="s4">'C'</span><span class="s3">: [</span><span class="s5">0.01</span><span class="s3">, </span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">10</span><span class="s3">], </span><span class="s4">'solver'</span><span class="s3">: [</span><span class="s4">'liblinear'</span><span class="s3">, </span><span class="s4">'saga'</span><span class="s3">], </span><span class="s4">'max_iter'</span><span class="s3">: [</span><span class="s5">20</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">200</span><span class="s3">]},</span>
<a name="l578"><span class="ln">578  </span></a>    <span class="s3">{</span><span class="s4">'penalty'</span><span class="s3">: [</span><span class="s4">'elasticnet'</span><span class="s3">], </span><span class="s4">'C'</span><span class="s3">: [</span><span class="s5">0.01</span><span class="s3">, </span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">10</span><span class="s3">], </span><span class="s4">'solver'</span><span class="s3">: [</span><span class="s4">'saga'</span><span class="s3">], </span><span class="s4">'l1_ratio'</span><span class="s3">: [</span><span class="s5">0.5</span><span class="s3">], </span><span class="s4">'max_iter'</span><span class="s3">: [</span><span class="s5">20</span><span class="s3">, </span><span class="s5">50</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s5">200</span><span class="s3">]}</span>
<a name="l579"><span class="ln">579  </span></a><span class="s3">]</span>
<a name="l580"><span class="ln">580  </span></a>
<a name="l581"><span class="ln">581  </span></a>
<a name="l582"><span class="ln">582  </span></a><span class="s0"># Initialize GridSearchCV</span>
<a name="l583"><span class="ln">583  </span></a><span class="s1">grid_search_lr </span><span class="s3">= </span><span class="s1">GridSearchCV</span><span class="s3">(</span>
<a name="l584"><span class="ln">584  </span></a>    <span class="s1">estimator</span><span class="s3">=</span><span class="s1">LogisticRegression</span><span class="s3">(</span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">),</span>
<a name="l585"><span class="ln">585  </span></a>    <span class="s1">param_grid</span><span class="s3">=</span><span class="s1">param_grid_lr</span><span class="s3">,</span>
<a name="l586"><span class="ln">586  </span></a>    <span class="s1">scoring</span><span class="s3">=</span><span class="s4">'f1'</span><span class="s3">,</span>
<a name="l587"><span class="ln">587  </span></a>    <span class="s1">cv</span><span class="s3">=</span><span class="s5">5</span><span class="s3">,</span>
<a name="l588"><span class="ln">588  </span></a>    <span class="s1">verbose</span><span class="s3">=</span><span class="s5">1</span><span class="s3">,</span>
<a name="l589"><span class="ln">589  </span></a>    <span class="s1">n_jobs</span><span class="s3">=-</span><span class="s5">1</span>
<a name="l590"><span class="ln">590  </span></a><span class="s3">)</span>
<a name="l591"><span class="ln">591  </span></a>
<a name="l592"><span class="ln">592  </span></a><span class="s0"># Perform the grid search</span>
<a name="l593"><span class="ln">593  </span></a><span class="s1">grid_search_lr</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">x_train_lr</span><span class="s3">, </span><span class="s1">y_train_lr</span><span class="s3">)</span>
<a name="l594"><span class="ln">594  </span></a>
<a name="l595"><span class="ln">595  </span></a><span class="s0"># Retrieve the best model from the search</span>
<a name="l596"><span class="ln">596  </span></a><span class="s1">best_lr_clf </span><span class="s3">= </span><span class="s1">grid_search_lr</span><span class="s3">.</span><span class="s1">best_estimator_</span>
<a name="l597"><span class="ln">597  </span></a>
<a name="l598"><span class="ln">598  </span></a><span class="s0"># Make predictions on the test set using the best model</span>
<a name="l599"><span class="ln">599  </span></a><span class="s1">y_pred_lr </span><span class="s3">= </span><span class="s1">best_lr_clf</span><span class="s3">.</span><span class="s1">predict</span><span class="s3">(</span><span class="s1">x_test_lr</span><span class="s3">)</span>
<a name="l600"><span class="ln">600  </span></a>
<a name="l601"><span class="ln">601  </span></a><span class="s0"># Evaluate the best model</span>
<a name="l602"><span class="ln">602  </span></a><span class="s1">accuracy_lr </span><span class="s3">= </span><span class="s1">accuracy_score</span><span class="s3">(</span><span class="s1">y_test_lr</span><span class="s3">, </span><span class="s1">y_pred_lr</span><span class="s3">)</span>
<a name="l603"><span class="ln">603  </span></a><span class="s1">precision_lr </span><span class="s3">= </span><span class="s1">precision_score</span><span class="s3">(</span><span class="s1">y_test_lr</span><span class="s3">, </span><span class="s1">y_pred_lr</span><span class="s3">)</span>
<a name="l604"><span class="ln">604  </span></a><span class="s1">recall_lr </span><span class="s3">= </span><span class="s1">recall_score</span><span class="s3">(</span><span class="s1">y_test_lr</span><span class="s3">, </span><span class="s1">y_pred_lr</span><span class="s3">)</span>
<a name="l605"><span class="ln">605  </span></a><span class="s1">f1_score_lr </span><span class="s3">= </span><span class="s1">f1_score</span><span class="s3">(</span><span class="s1">y_test_lr</span><span class="s3">, </span><span class="s1">y_pred_lr</span><span class="s3">)</span>
<a name="l606"><span class="ln">606  </span></a>
<a name="l607"><span class="ln">607  </span></a><span class="s0"># Print the results</span>
<a name="l608"><span class="ln">608  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;Best Parameters for Logistic Regression Classifier:&quot;</span><span class="s3">, </span><span class="s1">grid_search_lr</span><span class="s3">.</span><span class="s1">best_params_</span><span class="s3">)</span>
<a name="l609"><span class="ln">609  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Accuracy: </span><span class="s2">{</span><span class="s1">accuracy_lr</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l610"><span class="ln">610  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Precision: </span><span class="s2">{</span><span class="s1">precision_lr</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l611"><span class="ln">611  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'Recall: </span><span class="s2">{</span><span class="s1">recall_lr</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l612"><span class="ln">612  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">f'F1 Score: </span><span class="s2">{</span><span class="s1">f1_score_lr</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l613"><span class="ln">613  </span></a>
<a name="l614"><span class="ln">614  </span></a><span class="s0">#Capture that we need to filter this via f1 because even though it might lead to some extra marketing spend due to false positives, the higher recall ensures you engage every customer who might leave, which is typically the priority in retention strategies.</span><hr class="ls0"><a name="l615"><span class="ln">615  </span></a><span class="s0">#%% 
<a name="l616"><span class="ln">616  </span></a>#Logistic Regression Classifier</span>
<a name="l617"><span class="ln">617  </span></a><span class="s1">x_lr </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">([</span><span class="s4">'Churn'</span><span class="s3">,</span><span class="s4">'tenure'</span><span class="s3">], </span><span class="s1">axis</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l618"><span class="ln">618  </span></a><span class="s1">y_lr </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">]</span>
<a name="l619"><span class="ln">619  </span></a>
<a name="l620"><span class="ln">620  </span></a><span class="s0"># Define possible test sizes</span>
<a name="l621"><span class="ln">621  </span></a><span class="s1">test_sizes </span><span class="s3">= [</span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">0.2</span><span class="s3">, </span><span class="s5">0.3</span><span class="s3">, </span><span class="s5">0.4</span><span class="s3">]</span>
<a name="l622"><span class="ln">622  </span></a>
<a name="l623"><span class="ln">623  </span></a><span class="s0"># Store results for each test size</span>
<a name="l624"><span class="ln">624  </span></a><span class="s1">results_lr </span><span class="s3">= []</span>
<a name="l625"><span class="ln">625  </span></a>
<a name="l626"><span class="ln">626  </span></a><span class="s2">for </span><span class="s1">test_size </span><span class="s2">in </span><span class="s1">test_sizes</span><span class="s3">:</span>
<a name="l627"><span class="ln">627  </span></a>    <span class="s0"># print(f&quot;\nTesting with test_size = {test_size}&quot;)</span>
<a name="l628"><span class="ln">628  </span></a>
<a name="l629"><span class="ln">629  </span></a>    <span class="s0"># Split the data</span>
<a name="l630"><span class="ln">630  </span></a>    <span class="s1">x_train_lr</span><span class="s3">, </span><span class="s1">x_test_lr</span><span class="s3">, </span><span class="s1">y_train_lr</span><span class="s3">, </span><span class="s1">y_test_lr </span><span class="s3">= </span><span class="s1">train_test_split</span><span class="s3">(</span>
<a name="l631"><span class="ln">631  </span></a>        <span class="s1">x_lr</span><span class="s3">, </span><span class="s1">y_lr</span><span class="s3">, </span><span class="s1">test_size</span><span class="s3">=</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span>
<a name="l632"><span class="ln">632  </span></a>    <span class="s3">)</span>
<a name="l633"><span class="ln">633  </span></a>
<a name="l634"><span class="ln">634  </span></a>    <span class="s0"># Initialize and fit the Logistic Regression model</span>
<a name="l635"><span class="ln">635  </span></a>    <span class="s1">model </span><span class="s3">= </span><span class="s1">LogisticRegression</span><span class="s3">(</span>
<a name="l636"><span class="ln">636  </span></a>    <span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">,</span>
<a name="l637"><span class="ln">637  </span></a>    <span class="s1">C</span><span class="s3">=</span><span class="s5">0.01</span><span class="s3">,</span>
<a name="l638"><span class="ln">638  </span></a>    <span class="s1">l1_ratio</span><span class="s3">=</span><span class="s5">0.5</span><span class="s3">,</span>
<a name="l639"><span class="ln">639  </span></a>    <span class="s1">max_iter</span><span class="s3">=</span><span class="s5">200</span><span class="s3">,</span>
<a name="l640"><span class="ln">640  </span></a>    <span class="s1">penalty</span><span class="s3">=</span><span class="s4">'elasticnet'</span><span class="s3">,</span>
<a name="l641"><span class="ln">641  </span></a>    <span class="s1">solver</span><span class="s3">=</span><span class="s4">'saga'</span><span class="s3">,</span>
<a name="l642"><span class="ln">642  </span></a>    <span class="s3">)</span>
<a name="l643"><span class="ln">643  </span></a>
<a name="l644"><span class="ln">644  </span></a>    <span class="s1">model</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">x_train_lr</span><span class="s3">, </span><span class="s1">y_train_lr</span><span class="s3">)</span>
<a name="l645"><span class="ln">645  </span></a>
<a name="l646"><span class="ln">646  </span></a>    <span class="s0"># Make predictions</span>
<a name="l647"><span class="ln">647  </span></a>    <span class="s1">y_pred </span><span class="s3">= </span><span class="s1">model</span><span class="s3">.</span><span class="s1">predict</span><span class="s3">(</span><span class="s1">x_test_lr</span><span class="s3">)</span>
<a name="l648"><span class="ln">648  </span></a>
<a name="l649"><span class="ln">649  </span></a>    <span class="s0"># Evaluate performance</span>
<a name="l650"><span class="ln">650  </span></a>    <span class="s1">accuracy </span><span class="s3">= </span><span class="s1">accuracy_score</span><span class="s3">(</span><span class="s1">y_test_lr</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">)</span>
<a name="l651"><span class="ln">651  </span></a>    <span class="s1">precision </span><span class="s3">= </span><span class="s1">precision_score</span><span class="s3">(</span><span class="s1">y_test_lr</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">, </span><span class="s1">zero_division</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)  </span><span class="s0"># Handle undefined precision</span>
<a name="l652"><span class="ln">652  </span></a>    <span class="s1">recall </span><span class="s3">= </span><span class="s1">recall_score</span><span class="s3">(</span><span class="s1">y_test_lr</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">, </span><span class="s1">zero_division</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l653"><span class="ln">653  </span></a>    <span class="s1">f1 </span><span class="s3">= </span><span class="s1">f1_score</span><span class="s3">(</span><span class="s1">y_test_lr</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">, </span><span class="s1">zero_division</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l654"><span class="ln">654  </span></a>    <span class="s1">auc_roc </span><span class="s3">= </span><span class="s1">roc_auc_score</span><span class="s3">(</span><span class="s1">y_test_lr</span><span class="s3">, </span><span class="s1">y_pred</span><span class="s3">)</span>
<a name="l655"><span class="ln">655  </span></a>
<a name="l656"><span class="ln">656  </span></a>    <span class="s0"># Store the results</span>
<a name="l657"><span class="ln">657  </span></a>    <span class="s1">results_lr</span><span class="s3">.</span><span class="s1">append</span><span class="s3">((</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">accuracy</span><span class="s3">, </span><span class="s1">precision</span><span class="s3">, </span><span class="s1">recall</span><span class="s3">, </span><span class="s1">f1</span><span class="s3">, </span><span class="s1">auc_roc</span><span class="s3">))</span>
<a name="l658"><span class="ln">658  </span></a>
<a name="l659"><span class="ln">659  </span></a>    <span class="s0"># print(f&quot;Accuracy: {accuracy:.3f}, Precision: {precision:.3f}, Recall: {recall:.3f}, F1-Score: {f1:.3f}&quot;)</span>
<a name="l660"><span class="ln">660  </span></a>
<a name="l661"><span class="ln">661  </span></a><span class="s0"># Display all results at the end</span>
<a name="l662"><span class="ln">662  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">Summary of Results of Logistic Regression Classifier:&quot;</span><span class="s3">)</span>
<a name="l663"><span class="ln">663  </span></a><span class="s2">for </span><span class="s1">i</span><span class="s3">, (</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">accuracy</span><span class="s3">, </span><span class="s1">precision</span><span class="s3">, </span><span class="s1">recall</span><span class="s3">, </span><span class="s1">f1</span><span class="s3">, </span><span class="s1">auc_roc</span><span class="s3">) </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">results_lr</span><span class="s3">):</span>
<a name="l664"><span class="ln">664  </span></a>    <span class="s2">if </span><span class="s1">i </span><span class="s3">== </span><span class="s5">1</span><span class="s3">:  </span><span class="s0"># Highlight the second record</span>
<a name="l665"><span class="ln">665  </span></a>        <span class="s1">print</span><span class="s3">(</span>
<a name="l666"><span class="ln">666  </span></a>            <span class="s4">f&quot;</span><span class="s2">\033</span><span class="s4">[1mTest Size: </span><span class="s2">{</span><span class="s1">test_size</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">} </span><span class="s4">| Accuracy: </span><span class="s2">{</span><span class="s1">accuracy</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Precision: </span><span class="s2">{</span><span class="s1">precision</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Recall: </span><span class="s2">{</span><span class="s1">recall</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, F1-Score: </span><span class="s2">{</span><span class="s1">f1</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, AUC-ROC: </span><span class="s2">{</span><span class="s1">auc_roc</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}\033</span><span class="s4">[0m&quot;</span><span class="s3">)</span>
<a name="l667"><span class="ln">667  </span></a>    <span class="s2">else</span><span class="s3">:</span>
<a name="l668"><span class="ln">668  </span></a>        <span class="s1">print</span><span class="s3">(</span>
<a name="l669"><span class="ln">669  </span></a>            <span class="s4">f&quot;Test Size: </span><span class="s2">{</span><span class="s1">test_size</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">} </span><span class="s4">| Accuracy: </span><span class="s2">{</span><span class="s1">accuracy</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Precision: </span><span class="s2">{</span><span class="s1">precision</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Recall: </span><span class="s2">{</span><span class="s1">recall</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, F1-Score: </span><span class="s2">{</span><span class="s1">f1</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, AUC-ROC: </span><span class="s2">{</span><span class="s1">auc_roc</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
<a name="l670"><span class="ln">670  </span></a><hr class="ls0"><a name="l671"><span class="ln">671  </span></a><span class="s0">#%% md 
<a name="l672"><span class="ln">672  </span></a></span><span class="s1">### **Comparison of Logistic Regression and Decision Tree Models** 
<a name="l673"><span class="ln">673  </span></a> 
<a name="l674"><span class="ln">674  </span></a>#### **Performance Comparison Using Evaluation Metrics** 
<a name="l675"><span class="ln">675  </span></a> 
<a name="l676"><span class="ln">676  </span></a>| Metric        | Logistic Regression | Decision Tree | 
<a name="l677"><span class="ln">677  </span></a>|---------------|---------------------|---------------| 
<a name="l678"><span class="ln">678  </span></a>| **Accuracy**  | **0.507**           | 0.491         | 
<a name="l679"><span class="ln">679  </span></a>| **Precision** | **0.507**           | 0.499         | 
<a name="l680"><span class="ln">680  </span></a>| **Recall**    | **1.000**           | 0.630         | 
<a name="l681"><span class="ln">681  </span></a>| **F1-Score**  | **0.673**           | 0.557         | 
<a name="l682"><span class="ln">682  </span></a>| **AUC-ROC**   | **0.500**           | 0.488         | 
<a name="l683"><span class="ln">683  </span></a> 
<a name="l684"><span class="ln">684  </span></a>#### **Observations** 
<a name="l685"><span class="ln">685  </span></a>1. **Logistic Regression has better recall (1.000) compared to Decision Tree (0.630)**, meaning it captures all churn cases, but this might indicate it is predicting all customers as churners. 
<a name="l686"><span class="ln">686  </span></a>2. **F1-score is higher for Logistic Regression (0.673 vs. 0.557), meaning it balances precision and recall better.** 
<a name="l687"><span class="ln">687  </span></a>3. **Accuracy is slightly better for Logistic Regression (50.7% vs. 49.1%), but both models are close to random guessing (~50%).** 
<a name="l688"><span class="ln">688  </span></a>4. **AUC-ROC for both models is poor (Logistic Regression = 0.500, Decision Tree = 0.488), indicating neither model is effectively separating churners from non-churners.** 
<a name="l689"><span class="ln">689  </span></a> 
<a name="l690"><span class="ln">690  </span></a>#### **Conclusion** 
<a name="l691"><span class="ln">691  </span></a>- **Logistic Regression performs better in terms of recall and F1-score, making it preferable for capturing churn cases.** 
<a name="l692"><span class="ln">692  </span></a>- **However, its AUC-ROC score suggests that it does not separate the classes well and might be over-predicting churn.** 
<a name="l693"><span class="ln">693  </span></a>- **Decision Tree is worse overall and does not add significant improvement.** 
<a name="l694"><span class="ln">694  </span></a> 
<a name="l695"><span class="ln">695  </span></a>We will now use K-Nearest Neighbour and Ensemble Methods to check if we can improve on the performance. 
<a name="l696"><span class="ln">696  </span></a> <hr class="ls0"><a name="l697"><span class="ln">697  </span></a></span><span class="s0">#%% md 
<a name="l698"><span class="ln">698  </span></a></span><span class="s1">#Assignment 2 <hr class="ls0"><a name="l699"><span class="ln">699  </span></a></span><span class="s0">#%% 
<a name="l700"><span class="ln">700  </span></a># K-Nearest Neighbors Classifier</span>
<a name="l701"><span class="ln">701  </span></a>
<a name="l702"><span class="ln">702  </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">neighbors </span><span class="s2">import </span><span class="s1">KNeighborsClassifier</span>
<a name="l703"><span class="ln">703  </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">model_selection </span><span class="s2">import </span><span class="s1">train_test_split</span>
<a name="l704"><span class="ln">704  </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">metrics </span><span class="s2">import </span><span class="s1">accuracy_score</span><span class="s3">, </span><span class="s1">precision_score</span><span class="s3">, </span><span class="s1">recall_score</span><span class="s3">, </span><span class="s1">f1_score</span><span class="s3">, </span><span class="s1">roc_auc_score</span>
<a name="l705"><span class="ln">705  </span></a>
<a name="l706"><span class="ln">706  </span></a><span class="s0"># Define features and target</span>
<a name="l707"><span class="ln">707  </span></a><span class="s1">x_knn </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">([</span><span class="s4">'Churn'</span><span class="s3">, </span><span class="s4">'tenure'</span><span class="s3">], </span><span class="s1">axis</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l708"><span class="ln">708  </span></a><span class="s1">y_knn </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">]</span>
<a name="l709"><span class="ln">709  </span></a>
<a name="l710"><span class="ln">710  </span></a><span class="s0"># Define possible test sizes</span>
<a name="l711"><span class="ln">711  </span></a><span class="s1">test_sizes </span><span class="s3">= [</span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">0.2</span><span class="s3">, </span><span class="s5">0.3</span><span class="s3">, </span><span class="s5">0.4</span><span class="s3">]</span>
<a name="l712"><span class="ln">712  </span></a>
<a name="l713"><span class="ln">713  </span></a><span class="s0"># Store results for each test size</span>
<a name="l714"><span class="ln">714  </span></a><span class="s1">results_knn </span><span class="s3">= []</span>
<a name="l715"><span class="ln">715  </span></a>
<a name="l716"><span class="ln">716  </span></a><span class="s2">for </span><span class="s1">test_size </span><span class="s2">in </span><span class="s1">test_sizes</span><span class="s3">:</span>
<a name="l717"><span class="ln">717  </span></a>    <span class="s0"># Split the data</span>
<a name="l718"><span class="ln">718  </span></a>    <span class="s1">x_train_knn</span><span class="s3">, </span><span class="s1">x_test_knn</span><span class="s3">, </span><span class="s1">y_train_knn</span><span class="s3">, </span><span class="s1">y_test_knn </span><span class="s3">= </span><span class="s1">train_test_split</span><span class="s3">(</span>
<a name="l719"><span class="ln">719  </span></a>        <span class="s1">x_knn</span><span class="s3">, </span><span class="s1">y_knn</span><span class="s3">, </span><span class="s1">test_size</span><span class="s3">=</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span>
<a name="l720"><span class="ln">720  </span></a>    <span class="s3">)</span>
<a name="l721"><span class="ln">721  </span></a>
<a name="l722"><span class="ln">722  </span></a>    <span class="s0"># Initialize the KNN model with the specified hyperparameters (Hyper parameters are taken from the grid search)</span>
<a name="l723"><span class="ln">723  </span></a>    <span class="s1">knn_model </span><span class="s3">= </span><span class="s1">KNeighborsClassifier</span><span class="s3">(</span>
<a name="l724"><span class="ln">724  </span></a>        <span class="s1">metric</span><span class="s3">=</span><span class="s4">'euclidean'</span><span class="s3">,</span>
<a name="l725"><span class="ln">725  </span></a>        <span class="s1">n_neighbors</span><span class="s3">=</span><span class="s5">5</span><span class="s3">,</span>
<a name="l726"><span class="ln">726  </span></a>        <span class="s1">weights</span><span class="s3">=</span><span class="s4">'distance'</span>
<a name="l727"><span class="ln">727  </span></a>    <span class="s3">)</span>
<a name="l728"><span class="ln">728  </span></a>
<a name="l729"><span class="ln">729  </span></a>    <span class="s0"># Fit the model</span>
<a name="l730"><span class="ln">730  </span></a>    <span class="s1">knn_model</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">x_train_knn</span><span class="s3">, </span><span class="s1">y_train_knn</span><span class="s3">)</span>
<a name="l731"><span class="ln">731  </span></a>
<a name="l732"><span class="ln">732  </span></a>    <span class="s0"># Make predictions</span>
<a name="l733"><span class="ln">733  </span></a>    <span class="s1">y_pred_knn </span><span class="s3">= </span><span class="s1">knn_model</span><span class="s3">.</span><span class="s1">predict</span><span class="s3">(</span><span class="s1">x_test_knn</span><span class="s3">)</span>
<a name="l734"><span class="ln">734  </span></a>
<a name="l735"><span class="ln">735  </span></a>    <span class="s0"># Evaluate performance</span>
<a name="l736"><span class="ln">736  </span></a>    <span class="s1">accuracy </span><span class="s3">= </span><span class="s1">accuracy_score</span><span class="s3">(</span><span class="s1">y_test_knn</span><span class="s3">, </span><span class="s1">y_pred_knn</span><span class="s3">)</span>
<a name="l737"><span class="ln">737  </span></a>    <span class="s1">precision </span><span class="s3">= </span><span class="s1">precision_score</span><span class="s3">(</span><span class="s1">y_test_knn</span><span class="s3">, </span><span class="s1">y_pred_knn</span><span class="s3">, </span><span class="s1">zero_division</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l738"><span class="ln">738  </span></a>    <span class="s1">recall </span><span class="s3">= </span><span class="s1">recall_score</span><span class="s3">(</span><span class="s1">y_test_knn</span><span class="s3">, </span><span class="s1">y_pred_knn</span><span class="s3">, </span><span class="s1">zero_division</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l739"><span class="ln">739  </span></a>    <span class="s1">f1 </span><span class="s3">= </span><span class="s1">f1_score</span><span class="s3">(</span><span class="s1">y_test_knn</span><span class="s3">, </span><span class="s1">y_pred_knn</span><span class="s3">, </span><span class="s1">zero_division</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l740"><span class="ln">740  </span></a>    <span class="s1">auc_roc </span><span class="s3">= </span><span class="s1">roc_auc_score</span><span class="s3">(</span><span class="s1">y_test_knn</span><span class="s3">, </span><span class="s1">y_pred_knn</span><span class="s3">)</span>
<a name="l741"><span class="ln">741  </span></a>
<a name="l742"><span class="ln">742  </span></a>    <span class="s0"># Store the results</span>
<a name="l743"><span class="ln">743  </span></a>    <span class="s1">results_knn</span><span class="s3">.</span><span class="s1">append</span><span class="s3">((</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">accuracy</span><span class="s3">, </span><span class="s1">precision</span><span class="s3">, </span><span class="s1">recall</span><span class="s3">, </span><span class="s1">f1</span><span class="s3">, </span><span class="s1">auc_roc</span><span class="s3">))</span>
<a name="l744"><span class="ln">744  </span></a>
<a name="l745"><span class="ln">745  </span></a><span class="s0"># Display all results at the end</span>
<a name="l746"><span class="ln">746  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">Summary of Results for K-Nearest Neighbors Classifier:&quot;</span><span class="s3">)</span>
<a name="l747"><span class="ln">747  </span></a><span class="s2">for </span><span class="s1">i</span><span class="s3">, (</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">accuracy</span><span class="s3">, </span><span class="s1">precision</span><span class="s3">, </span><span class="s1">recall</span><span class="s3">, </span><span class="s1">f1</span><span class="s3">, </span><span class="s1">auc_roc</span><span class="s3">) </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">results_knn</span><span class="s3">):</span>
<a name="l748"><span class="ln">748  </span></a>    <span class="s2">if </span><span class="s1">i </span><span class="s3">== </span><span class="s5">1</span><span class="s3">:  </span><span class="s0"># Highlight the second record</span>
<a name="l749"><span class="ln">749  </span></a>        <span class="s1">print</span><span class="s3">(</span>
<a name="l750"><span class="ln">750  </span></a>            <span class="s4">f&quot;</span><span class="s2">\033</span><span class="s4">[1mTest Size: </span><span class="s2">{</span><span class="s1">test_size</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">} </span><span class="s4">| Accuracy: </span><span class="s2">{</span><span class="s1">accuracy</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Precision: </span><span class="s2">{</span><span class="s1">precision</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Recall: </span><span class="s2">{</span><span class="s1">recall</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, F1-Score: </span><span class="s2">{</span><span class="s1">f1</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, AUC-ROC: </span><span class="s2">{</span><span class="s1">auc_roc</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}\033</span><span class="s4">[0m&quot;</span><span class="s3">)</span>
<a name="l751"><span class="ln">751  </span></a>    <span class="s2">else</span><span class="s3">:</span>
<a name="l752"><span class="ln">752  </span></a>        <span class="s1">print</span><span class="s3">(</span>
<a name="l753"><span class="ln">753  </span></a>            <span class="s4">f&quot;Test Size: </span><span class="s2">{</span><span class="s1">test_size</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">} </span><span class="s4">| Accuracy: </span><span class="s2">{</span><span class="s1">accuracy</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Precision: </span><span class="s2">{</span><span class="s1">precision</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Recall: </span><span class="s2">{</span><span class="s1">recall</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, F1-Score: </span><span class="s2">{</span><span class="s1">f1</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, AUC-ROC: </span><span class="s2">{</span><span class="s1">auc_roc</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
<a name="l754"><span class="ln">754  </span></a>
<a name="l755"><span class="ln">755  </span></a>
<a name="l756"><span class="ln">756  </span></a><hr class="ls0"><a name="l757"><span class="ln">757  </span></a><span class="s0">#%% 
<a name="l758"><span class="ln">758  </span></a># Random Forest Classifier</span>
<a name="l759"><span class="ln">759  </span></a>
<a name="l760"><span class="ln">760  </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">ensemble </span><span class="s2">import </span><span class="s1">RandomForestClassifier</span>
<a name="l761"><span class="ln">761  </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">model_selection </span><span class="s2">import </span><span class="s1">train_test_split</span>
<a name="l762"><span class="ln">762  </span></a><span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">metrics </span><span class="s2">import </span><span class="s1">accuracy_score</span><span class="s3">, </span><span class="s1">precision_score</span><span class="s3">, </span><span class="s1">recall_score</span><span class="s3">, </span><span class="s1">f1_score</span><span class="s3">, </span><span class="s1">roc_auc_score</span>
<a name="l763"><span class="ln">763  </span></a>
<a name="l764"><span class="ln">764  </span></a><span class="s0"># Feature matrix and target variable</span>
<a name="l765"><span class="ln">765  </span></a><span class="s1">x_rf </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">.</span><span class="s1">drop</span><span class="s3">([</span><span class="s4">'Churn'</span><span class="s3">, </span><span class="s4">'tenure'</span><span class="s3">], </span><span class="s1">axis</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l766"><span class="ln">766  </span></a><span class="s1">y_rf </span><span class="s3">= </span><span class="s1">df_preprocessed</span><span class="s3">[</span><span class="s4">'Churn'</span><span class="s3">]</span>
<a name="l767"><span class="ln">767  </span></a>
<a name="l768"><span class="ln">768  </span></a><span class="s0"># Define possible test sizes</span>
<a name="l769"><span class="ln">769  </span></a><span class="s1">test_sizes </span><span class="s3">= [</span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">0.2</span><span class="s3">, </span><span class="s5">0.3</span><span class="s3">, </span><span class="s5">0.4</span><span class="s3">]</span>
<a name="l770"><span class="ln">770  </span></a>
<a name="l771"><span class="ln">771  </span></a><span class="s0"># Store results for each test size</span>
<a name="l772"><span class="ln">772  </span></a><span class="s1">results_rf </span><span class="s3">= []</span>
<a name="l773"><span class="ln">773  </span></a>
<a name="l774"><span class="ln">774  </span></a><span class="s2">for </span><span class="s1">test_size </span><span class="s2">in </span><span class="s1">test_sizes</span><span class="s3">:</span>
<a name="l775"><span class="ln">775  </span></a>    <span class="s0"># Split the data</span>
<a name="l776"><span class="ln">776  </span></a>    <span class="s1">x_train_rf</span><span class="s3">, </span><span class="s1">x_test_rf</span><span class="s3">, </span><span class="s1">y_train_rf</span><span class="s3">, </span><span class="s1">y_test_rf </span><span class="s3">= </span><span class="s1">train_test_split</span><span class="s3">(</span>
<a name="l777"><span class="ln">777  </span></a>        <span class="s1">x_rf</span><span class="s3">, </span><span class="s1">y_rf</span><span class="s3">, </span><span class="s1">test_size</span><span class="s3">=</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span>
<a name="l778"><span class="ln">778  </span></a>    <span class="s3">)</span>
<a name="l779"><span class="ln">779  </span></a>
<a name="l780"><span class="ln">780  </span></a>    <span class="s0"># Initialize Random Forest model with specified hyperparameters</span>
<a name="l781"><span class="ln">781  </span></a>    <span class="s1">rf_model </span><span class="s3">= </span><span class="s1">RandomForestClassifier</span><span class="s3">(</span>
<a name="l782"><span class="ln">782  </span></a>        <span class="s1">n_estimators</span><span class="s3">=</span><span class="s5">100</span><span class="s3">,  </span><span class="s0"># Number of trees in the forest</span>
<a name="l783"><span class="ln">783  </span></a>        <span class="s1">max_depth</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,  </span><span class="s0"># Maximum depth of the tree (None means nodes expand until all leaves are pure)</span>
<a name="l784"><span class="ln">784  </span></a>        <span class="s1">random_state</span><span class="s3">=</span><span class="s5">42</span><span class="s3">,  </span><span class="s0"># Random seed for reproducibility</span>
<a name="l785"><span class="ln">785  </span></a>        <span class="s1">bootstrap</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,  </span><span class="s0"># Bagging enabled</span>
<a name="l786"><span class="ln">786  </span></a>    <span class="s3">)</span>
<a name="l787"><span class="ln">787  </span></a>
<a name="l788"><span class="ln">788  </span></a>    <span class="s0"># Fit the model on the training data</span>
<a name="l789"><span class="ln">789  </span></a>    <span class="s1">rf_model</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">x_train_rf</span><span class="s3">, </span><span class="s1">y_train_rf</span><span class="s3">)</span>
<a name="l790"><span class="ln">790  </span></a>
<a name="l791"><span class="ln">791  </span></a>    <span class="s0"># Make predictions on the test data</span>
<a name="l792"><span class="ln">792  </span></a>    <span class="s1">y_pred_rf </span><span class="s3">= </span><span class="s1">rf_model</span><span class="s3">.</span><span class="s1">predict</span><span class="s3">(</span><span class="s1">x_test_rf</span><span class="s3">)</span>
<a name="l793"><span class="ln">793  </span></a>
<a name="l794"><span class="ln">794  </span></a>    <span class="s0"># Evaluate performance</span>
<a name="l795"><span class="ln">795  </span></a>    <span class="s1">accuracy </span><span class="s3">= </span><span class="s1">accuracy_score</span><span class="s3">(</span><span class="s1">y_test_rf</span><span class="s3">, </span><span class="s1">y_pred_rf</span><span class="s3">)</span>
<a name="l796"><span class="ln">796  </span></a>    <span class="s1">precision </span><span class="s3">= </span><span class="s1">precision_score</span><span class="s3">(</span><span class="s1">y_test_rf</span><span class="s3">, </span><span class="s1">y_pred_rf</span><span class="s3">, </span><span class="s1">zero_division</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l797"><span class="ln">797  </span></a>    <span class="s1">recall </span><span class="s3">= </span><span class="s1">recall_score</span><span class="s3">(</span><span class="s1">y_test_rf</span><span class="s3">, </span><span class="s1">y_pred_rf</span><span class="s3">, </span><span class="s1">zero_division</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l798"><span class="ln">798  </span></a>    <span class="s1">f1 </span><span class="s3">= </span><span class="s1">f1_score</span><span class="s3">(</span><span class="s1">y_test_rf</span><span class="s3">, </span><span class="s1">y_pred_rf</span><span class="s3">, </span><span class="s1">zero_division</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l799"><span class="ln">799  </span></a>    <span class="s1">auc_roc </span><span class="s3">= </span><span class="s1">roc_auc_score</span><span class="s3">(</span><span class="s1">y_test_rf</span><span class="s3">, </span><span class="s1">y_pred_rf</span><span class="s3">)</span>
<a name="l800"><span class="ln">800  </span></a>
<a name="l801"><span class="ln">801  </span></a>    <span class="s0"># Store results</span>
<a name="l802"><span class="ln">802  </span></a>    <span class="s1">results_rf</span><span class="s3">.</span><span class="s1">append</span><span class="s3">((</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">accuracy</span><span class="s3">, </span><span class="s1">precision</span><span class="s3">, </span><span class="s1">recall</span><span class="s3">, </span><span class="s1">f1</span><span class="s3">, </span><span class="s1">auc_roc</span><span class="s3">))</span>
<a name="l803"><span class="ln">803  </span></a>
<a name="l804"><span class="ln">804  </span></a><span class="s0"># Display all results at the end</span>
<a name="l805"><span class="ln">805  </span></a><span class="s1">print</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">Summary of Results for Random Forest Classifier (Bagging):&quot;</span><span class="s3">)</span>
<a name="l806"><span class="ln">806  </span></a><span class="s2">for </span><span class="s1">i</span><span class="s3">, (</span><span class="s1">test_size</span><span class="s3">, </span><span class="s1">accuracy</span><span class="s3">, </span><span class="s1">precision</span><span class="s3">, </span><span class="s1">recall</span><span class="s3">, </span><span class="s1">f1</span><span class="s3">, </span><span class="s1">auc_roc</span><span class="s3">) </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">results_rf</span><span class="s3">):</span>
<a name="l807"><span class="ln">807  </span></a>    <span class="s2">if </span><span class="s1">i </span><span class="s3">== </span><span class="s5">1</span><span class="s3">:  </span><span class="s0"># Highlight the second record</span>
<a name="l808"><span class="ln">808  </span></a>        <span class="s1">print</span><span class="s3">(</span>
<a name="l809"><span class="ln">809  </span></a>            <span class="s4">f&quot;</span><span class="s2">\033</span><span class="s4">[1mTest Size: </span><span class="s2">{</span><span class="s1">test_size</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">} </span><span class="s4">| Accuracy: </span><span class="s2">{</span><span class="s1">accuracy</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Precision: </span><span class="s2">{</span><span class="s1">precision</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Recall: </span><span class="s2">{</span><span class="s1">recall</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, F1-Score: </span><span class="s2">{</span><span class="s1">f1</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, AUC-ROC: </span><span class="s2">{</span><span class="s1">auc_roc</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}\033</span><span class="s4">[0m&quot;</span>
<a name="l810"><span class="ln">810  </span></a>        <span class="s3">)</span>
<a name="l811"><span class="ln">811  </span></a>    <span class="s2">else</span><span class="s3">:</span>
<a name="l812"><span class="ln">812  </span></a>        <span class="s1">print</span><span class="s3">(</span>
<a name="l813"><span class="ln">813  </span></a>            <span class="s4">f&quot;Test Size: </span><span class="s2">{</span><span class="s1">test_size</span><span class="s2">:</span><span class="s4">.2f</span><span class="s2">} </span><span class="s4">| Accuracy: </span><span class="s2">{</span><span class="s1">accuracy</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Precision: </span><span class="s2">{</span><span class="s1">precision</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, Recall: </span><span class="s2">{</span><span class="s1">recall</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, F1-Score: </span><span class="s2">{</span><span class="s1">f1</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">, AUC-ROC: </span><span class="s2">{</span><span class="s1">auc_roc</span><span class="s2">:</span><span class="s4">.3f</span><span class="s2">}</span><span class="s4">&quot;</span>
<a name="l814"><span class="ln">814  </span></a>        <span class="s3">)</span>
<a name="l815"><span class="ln">815  </span></a><hr class="ls0"><a name="l816"><span class="ln">816  </span></a><span class="s0">#%% 
<a name="l817"><span class="ln">817  </span></a></span><span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<a name="l818"><span class="ln">818  </span></a><span class="s2">import </span><span class="s1">plotly</span><span class="s3">.</span><span class="s1">express </span><span class="s2">as </span><span class="s1">px</span>
<a name="l819"><span class="ln">819  </span></a>
<a name="l820"><span class="ln">820  </span></a><span class="s0"># Data</span>
<a name="l821"><span class="ln">821  </span></a><span class="s1">models </span><span class="s3">= [</span><span class="s4">'Decision Tree'</span><span class="s3">, </span><span class="s4">'Logistic Regression'</span><span class="s3">, </span><span class="s4">'KNN'</span><span class="s3">, </span><span class="s4">'Random Forest'</span><span class="s3">]</span>
<a name="l822"><span class="ln">822  </span></a><span class="s1">metrics </span><span class="s3">= [</span><span class="s4">'Accuracy'</span><span class="s3">, </span><span class="s4">'Precision'</span><span class="s3">, </span><span class="s4">'Recall'</span><span class="s3">, </span><span class="s4">'F1-Score'</span><span class="s3">, </span><span class="s4">'AUC-ROC'</span><span class="s3">]</span>
<a name="l823"><span class="ln">823  </span></a>
<a name="l824"><span class="ln">824  </span></a><span class="s0"># Extract the second (index 1) results for each model and round to 3 decimal places</span>
<a name="l825"><span class="ln">825  </span></a><span class="s1">data </span><span class="s3">= {</span>
<a name="l826"><span class="ln">826  </span></a>    <span class="s4">'Decision Tree'</span><span class="s3">: [</span><span class="s1">round</span><span class="s3">(</span><span class="s1">metric</span><span class="s3">, </span><span class="s5">3</span><span class="s3">) </span><span class="s2">for </span><span class="s1">metric </span><span class="s2">in </span><span class="s1">results_dt</span><span class="s3">[</span><span class="s5">1</span><span class="s3">][</span><span class="s5">1</span><span class="s3">:]],  </span><span class="s0"># Skip the test size (1st item)</span>
<a name="l827"><span class="ln">827  </span></a>    <span class="s4">'Logistic Regression'</span><span class="s3">: [</span><span class="s1">round</span><span class="s3">(</span><span class="s1">metric</span><span class="s3">, </span><span class="s5">3</span><span class="s3">) </span><span class="s2">for </span><span class="s1">metric </span><span class="s2">in </span><span class="s1">results_lr</span><span class="s3">[</span><span class="s5">1</span><span class="s3">][</span><span class="s5">1</span><span class="s3">:]],  </span><span class="s0"># Skip the test size</span>
<a name="l828"><span class="ln">828  </span></a>    <span class="s4">'KNN'</span><span class="s3">: [</span><span class="s1">round</span><span class="s3">(</span><span class="s1">metric</span><span class="s3">, </span><span class="s5">3</span><span class="s3">) </span><span class="s2">for </span><span class="s1">metric </span><span class="s2">in </span><span class="s1">results_knn</span><span class="s3">[</span><span class="s5">1</span><span class="s3">][</span><span class="s5">1</span><span class="s3">:]],  </span><span class="s0"># Skip the test size</span>
<a name="l829"><span class="ln">829  </span></a>    <span class="s4">'Random Forest'</span><span class="s3">: [</span><span class="s1">round</span><span class="s3">(</span><span class="s1">metric</span><span class="s3">, </span><span class="s5">3</span><span class="s3">) </span><span class="s2">for </span><span class="s1">metric </span><span class="s2">in </span><span class="s1">results_rf</span><span class="s3">[</span><span class="s5">1</span><span class="s3">][</span><span class="s5">1</span><span class="s3">:]]  </span><span class="s0"># Skip the test size</span>
<a name="l830"><span class="ln">830  </span></a><span class="s3">}</span>
<a name="l831"><span class="ln">831  </span></a>
<a name="l832"><span class="ln">832  </span></a><span class="s0"># Print the created data dictionary</span>
<a name="l833"><span class="ln">833  </span></a><span class="s0"># print(&quot;Extracted Data (Rounded to 3 Decimal Places):&quot;)</span>
<a name="l834"><span class="ln">834  </span></a><span class="s0"># print(data)</span>
<a name="l835"><span class="ln">835  </span></a>
<a name="l836"><span class="ln">836  </span></a><span class="s0"># Convert to DataFrame</span>
<a name="l837"><span class="ln">837  </span></a><span class="s1">df_models </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">DataFrame</span><span class="s3">(</span><span class="s1">data</span><span class="s3">, </span><span class="s1">index</span><span class="s3">=</span><span class="s1">metrics</span><span class="s3">)</span>
<a name="l838"><span class="ln">838  </span></a>
<a name="l839"><span class="ln">839  </span></a><span class="s0"># Transform DataFrame into long format for Plotly</span>
<a name="l840"><span class="ln">840  </span></a><span class="s1">df_melted </span><span class="s3">= </span><span class="s1">df_models</span><span class="s3">.</span><span class="s1">reset_index</span><span class="s3">().</span><span class="s1">melt</span><span class="s3">(</span><span class="s1">id_vars</span><span class="s3">=</span><span class="s4">'index'</span><span class="s3">, </span><span class="s1">var_name</span><span class="s3">=</span><span class="s4">'Model'</span><span class="s3">, </span><span class="s1">value_name</span><span class="s3">=</span><span class="s4">'Score'</span><span class="s3">)</span>
<a name="l841"><span class="ln">841  </span></a><span class="s1">df_melted</span><span class="s3">.</span><span class="s1">rename</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">={</span><span class="s4">'index'</span><span class="s3">: </span><span class="s4">'Metric'</span><span class="s3">}, </span><span class="s1">inplace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l842"><span class="ln">842  </span></a>
<a name="l843"><span class="ln">843  </span></a><span class="s0"># Plot using Plotly</span>
<a name="l844"><span class="ln">844  </span></a><span class="s1">fig </span><span class="s3">= </span><span class="s1">px</span><span class="s3">.</span><span class="s1">histogram</span><span class="s3">(</span>
<a name="l845"><span class="ln">845  </span></a>    <span class="s1">df_melted</span><span class="s3">,</span>
<a name="l846"><span class="ln">846  </span></a>    <span class="s1">x</span><span class="s3">=</span><span class="s4">'Metric'</span><span class="s3">,  </span><span class="s0"># Metrics on the x-axis</span>
<a name="l847"><span class="ln">847  </span></a>    <span class="s1">y</span><span class="s3">=</span><span class="s4">'Score'</span><span class="s3">,  </span><span class="s0"># Scores on the y-axis</span>
<a name="l848"><span class="ln">848  </span></a>    <span class="s1">color</span><span class="s3">=</span><span class="s4">'Model'</span><span class="s3">,  </span><span class="s0"># Grouped by models</span>
<a name="l849"><span class="ln">849  </span></a>    <span class="s1">barmode</span><span class="s3">=</span><span class="s4">'group'</span><span class="s3">,  </span><span class="s0"># Bars grouped side-by-side</span>
<a name="l850"><span class="ln">850  </span></a>    <span class="s1">title</span><span class="s3">=</span><span class="s4">'Model Performance Comparison'</span><span class="s3">,  </span><span class="s0"># Title of the chart</span>
<a name="l851"><span class="ln">851  </span></a>    <span class="s1">color_discrete_sequence</span><span class="s3">=</span><span class="s1">px</span><span class="s3">.</span><span class="s1">colors</span><span class="s3">.</span><span class="s1">qualitative</span><span class="s3">.</span><span class="s1">Prism  </span><span class="s0"># Define color palette</span>
<a name="l852"><span class="ln">852  </span></a><span class="s3">)</span>
<a name="l853"><span class="ln">853  </span></a>
<a name="l854"><span class="ln">854  </span></a><span class="s0"># Customize layout</span>
<a name="l855"><span class="ln">855  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">update_layout</span><span class="s3">(</span>
<a name="l856"><span class="ln">856  </span></a>    <span class="s1">xaxis_title</span><span class="s3">=</span><span class="s4">'Evaluation Metrics'</span><span class="s3">,</span>
<a name="l857"><span class="ln">857  </span></a>    <span class="s1">yaxis_title</span><span class="s3">=</span><span class="s4">'Score'</span><span class="s3">,</span>
<a name="l858"><span class="ln">858  </span></a>    <span class="s1">width</span><span class="s3">=</span><span class="s5">1000</span><span class="s3">,</span>
<a name="l859"><span class="ln">859  </span></a>    <span class="s1">height</span><span class="s3">=</span><span class="s5">500</span><span class="s3">,</span>
<a name="l860"><span class="ln">860  </span></a>    <span class="s1">legend_title</span><span class="s3">=</span><span class="s4">'Models'</span>
<a name="l861"><span class="ln">861  </span></a><span class="s3">)</span>
<a name="l862"><span class="ln">862  </span></a>
<a name="l863"><span class="ln">863  </span></a><span class="s0"># Show the interactive plot</span>
<a name="l864"><span class="ln">864  </span></a><span class="s1">fig</span><span class="s3">.</span><span class="s1">show</span><span class="s3">()</span>
<a name="l865"><span class="ln">865  </span></a><hr class="ls0"><a name="l866"><span class="ln">866  </span></a><span class="s0">#%% md 
<a name="l867"><span class="ln">867  </span></a></span>
<a name="l868"><span class="ln">868  </span></a>
<a name="l869"><span class="ln">869  </span></a>
<a name="l870"><span class="ln">870  </span></a><span class="s1"># Customer Churn Prediction Model Evaluation 
<a name="l871"><span class="ln">871  </span></a> 
<a name="l872"><span class="ln">872  </span></a>## Problem Statement 
<a name="l873"><span class="ln">873  </span></a> 
<a name="l874"><span class="ln">874  </span></a>Predicting customer churn is a critical task for telecommunications companies aiming to retain their customers and reduce revenue loss. **Customer churn** refers to the phenomenon where customers discontinue using the company's services. By accurately predicting which customers are likely to churn, companies can take proactive measures—such as targeted marketing campaigns, personalized offers, or improved customer service—to enhance customer satisfaction and retention. 
<a name="l875"><span class="ln">875  </span></a> 
<a name="l876"><span class="ln">876  </span></a>## Models Evaluated 
<a name="l877"><span class="ln">877  </span></a> 
<a name="l878"><span class="ln">878  </span></a>Four machine learning models have been trained to predict customer churn: 
<a name="l879"><span class="ln">879  </span></a> 
<a name="l880"><span class="ln">880  </span></a>- **Decision Tree** 
<a name="l881"><span class="ln">881  </span></a>- **Logistic Regression** 
<a name="l882"><span class="ln">882  </span></a>- **K-Nearest Neighbors (KNN)** 
<a name="l883"><span class="ln">883  </span></a>- **Random Forest** 
<a name="l884"><span class="ln">884  </span></a> 
<a name="l885"><span class="ln">885  </span></a>These models were evaluated based on the following performance metrics: 
<a name="l886"><span class="ln">886  </span></a> 
<a name="l887"><span class="ln">887  </span></a>- **Accuracy:** The overall correctness of the model. 
<a name="l888"><span class="ln">888  </span></a>- **Precision:** The proportion of predicted churners that are actual churners. 
<a name="l889"><span class="ln">889  </span></a>- **Recall:** The proportion of actual churners that the model successfully identifies. 
<a name="l890"><span class="ln">890  </span></a>- **F1-Score:** The harmonic mean of precision and recall, offering a balance between them. 
<a name="l891"><span class="ln">891  </span></a>- **AUC-ROC:** The model's ability to distinguish between churn and non-churn cases. 
<a name="l892"><span class="ln">892  </span></a> 
<a name="l893"><span class="ln">893  </span></a>## Performance Metrics Table 
<a name="l894"><span class="ln">894  </span></a> 
<a name="l895"><span class="ln">895  </span></a>| Model                   | Accuracy | Precision | Recall | F1-Score | AUC-ROC | 
<a name="l896"><span class="ln">896  </span></a>|-------------------------|----------|-----------|--------|----------|---------| 
<a name="l897"><span class="ln">897  </span></a>| **Decision Tree**       | 0.507    | 0.516     | 0.468  | 0.491    | 0.508   | 
<a name="l898"><span class="ln">898  </span></a>| **Logistic Regression** | 0.507    | 0.507     | 1.000  | 0.673    | 0.500   | 
<a name="l899"><span class="ln">899  </span></a>| **KNN**                 | 0.502    | 0.510     | 0.501  | 0.505    | 0.502   | 
<a name="l900"><span class="ln">900  </span></a>| **Random Forest**       | 0.504    | 0.511     | 0.514  | 0.513    | 0.504   | 
<a name="l901"><span class="ln">901  </span></a> 
<a name="l902"><span class="ln">902  </span></a>## Best Model Selection 
<a name="l903"><span class="ln">903  </span></a> 
<a name="l904"><span class="ln">904  </span></a>### **Logistic Regression** is identified as the best model for customer churn prediction. 
<a name="l905"><span class="ln">905  </span></a> 
<a name="l906"><span class="ln">906  </span></a>### Justification: 
<a name="l907"><span class="ln">907  </span></a> 
<a name="l908"><span class="ln">908  </span></a>1. **Highest Recall (1.000):** 
<a name="l909"><span class="ln">909  </span></a>   - **Recall** is critical in churn prediction because it measures the model’s ability to identify all actual churn cases. Missing any potential churner (false negative) could result in significant revenue loss. With a recall of 1.000, Logistic Regression ensures that every potential churn case is flagged for intervention. 
<a name="l910"><span class="ln">910  </span></a> 
<a name="l911"><span class="ln">911  </span></a>2. **Superior F1-Score (0.673):** 
<a name="l912"><span class="ln">912  </span></a>   - The **F1-Score** balances precision and recall. A higher F1-Score indicates that the model maintains a good balance between correctly identifying churners and minimizing false positives. Logistic Regression's F1-Score of 0.673 demonstrates that it effectively handles this trade-off. 
<a name="l913"><span class="ln">913  </span></a> 
<a name="l914"><span class="ln">914  </span></a>3. **Business Impact:** 
<a name="l915"><span class="ln">915  </span></a>   - In churn prediction, the cost of not identifying a churner (false negative) is typically far more damaging than the cost of falsely predicting churn (false positive). Hence, a model with exceptional recall is preferable. Logistic Regression’s ability to catch all potential churners directly supports the business goal of reducing revenue loss. 
<a name="l916"><span class="ln">916  </span></a> 
<a name="l917"><span class="ln">917  </span></a>4. **Model Simplicity and Interpretability:** 
<a name="l918"><span class="ln">918  </span></a>   - Logistic Regression is not only effective but also simple and interpretable. This makes it easier for stakeholders to understand the decision-making process, thereby fostering trust in the model’s predictions. 
<a name="l919"><span class="ln">919  </span></a> 
<a name="l920"><span class="ln">920  </span></a>### Considerations: 
<a name="l921"><span class="ln">921  </span></a> 
<a name="l922"><span class="ln">922  </span></a>- **AUC-ROC:** Although Logistic Regression has a slightly lower AUC-ROC score (0.500) compared to some other models, this metric is less critical in scenarios where missing a potential churner can have serious consequences. The marginal differences in AUC-ROC among the models mean that recall and F1-Score are more decisive in this context. 
<a name="l923"><span class="ln">923  </span></a>- **Trade-offs:** Every model has its strengths and weaknesses, but in the realm of customer churn, ensuring that no potential churner is overlooked is paramount. Thus, the benefits of high recall outweigh the slight shortcomings in other metrics. 
<a name="l924"><span class="ln">924  </span></a> 
<a name="l925"><span class="ln">925  </span></a>## Conclusion 
<a name="l926"><span class="ln">926  </span></a> 
<a name="l927"><span class="ln">927  </span></a>For the customer churn prediction task, **Logistic Regression** is the most suitable model. Its exceptional recall ensures that all potential churners are identified, while its balanced F1-Score indicates robust overall performance. This makes it an ideal choice for telecommunications companies seeking to implement effective strategies for customer retention and revenue protection. 
<a name="l928"><span class="ln">928  </span></a> <hr class="ls0"><a name="l929"><span class="ln">929  </span></a></span><span class="s0">#%% 
<a name="l930"><span class="ln">930  </span></a></span></pre>
</body>
</html>